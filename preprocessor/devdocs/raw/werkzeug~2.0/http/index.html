<h1 id="http-utilities">HTTP Utilities</h1> <p>Werkzeug provides a couple of functions to parse and generate HTTP headers that are useful when implementing WSGI middlewares or whenever you are operating on a lower level layer. All this functionality is also exposed from request and response objects.</p> <section id="datetime-functions"> <h2>Datetime Functions</h2> <p>These functions simplify working with times in an HTTP context. Werkzeug produces timezone-aware <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)"><code>datetime</code></a> objects in UTC. When passing datetime objects to Werkzeug, it assumes any naive datetime is in UTC.</p> <p>When comparing datetime values from Werkzeug, your own datetime objects must also be timezone-aware, or you must make the values from Werkzeug naive.</p> <ul class="simple"> <li>
<code>dt = datetime.now(timezone.utc)</code> gets the current time in UTC.</li> <li>
<code>dt = datetime(..., tzinfo=timezone.utc)</code> creates a time in UTC.</li> <li>
<code>dt = dt.replace(tzinfo=timezone.utc)</code> makes a naive object aware by assuming it’s in UTC.</li> <li>
<code>dt = dt.replace(tzinfo=None)</code> makes an aware object naive.</li> </ul> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_date">
<code>werkzeug.http.parse_date(value)</code> </dt> <dd>
<p>Parse an <a class="rfc reference external" href="https://tools.ietf.org/html/rfc2822.html" id="index-0"><strong>RFC 2822</strong></a> date into a timezone-aware <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)"><code>datetime.datetime</code></a> object, or <code>None</code> if parsing fails.</p> <p>This is a wrapper for <a class="reference external" href="https://docs.python.org/3/library/email.utils.html#email.utils.parsedate_to_datetime" title="(in Python v3.9)"><code>email.utils.parsedate_to_datetime()</code></a>. It returns <code>None</code> if parsing fails instead of raising an exception, and always returns a timezone-aware datetime object. If the string doesn’t have timezone information, it is assumed to be UTC.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – A string with a supported date format.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p>Optional[<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)">datetime.datetime</a>]</p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Return a timezone-aware datetime object. Use <code>email.utils.parsedate_to_datetime</code>.</p> </div> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.http_date">
<code>werkzeug.http.http_date(timestamp=None)</code> </dt> <dd>
<p>Format a datetime object or timestamp into an <a class="rfc reference external" href="https://tools.ietf.org/html/rfc2822.html" id="index-1"><strong>RFC 2822</strong></a> date string.</p> <p>This is a wrapper for <a class="reference external" href="https://docs.python.org/3/library/email.utils.html#email.utils.format_datetime" title="(in Python v3.9)"><code>email.utils.format_datetime()</code></a>. It assumes naive datetime objects are in UTC instead of raising an exception.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>timestamp</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)">datetime.datetime</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.9)">datetime.date</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/time.html#time.struct_time" title="(in Python v3.9)">time.struct_time</a><em>]</em><em>]</em>) – The datetime or timestamp to format. Defaults to the current time.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Use <code>email.utils.format_datetime</code>. Accept <code>date</code> objects.</p> </div> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.cookie_date">
<code>werkzeug.http.cookie_date(expires=None)</code> </dt> <dd>
<p>Format a datetime object or timestamp into an <a class="rfc reference external" href="https://tools.ietf.org/html/rfc2822.html" id="index-2"><strong>RFC 2822</strong></a> date string for <code>Set-Cookie expires</code>.</p> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <a class="reference internal" href="#werkzeug.http.http_date" title="werkzeug.http.http_date"><code>http_date()</code></a> instead.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>expires</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)">datetime.datetime</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.9)">datetime.date</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/time.html#time.struct_time" title="(in Python v3.9)">time.struct_time</a><em>]</em><em>]</em>) – </p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> </section> <section id="header-parsing"> <h2>Header Parsing</h2> <p>The following functions can be used to parse incoming HTTP headers. Because Python does not provide data structures with the semantics required by <a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html" id="index-3"><strong>RFC 2616</strong></a>, Werkzeug implements some custom data structures that are <a class="reference internal" href="../datastructures/index#http-datastructures"><span class="std std-ref">documented separately</span></a>.</p> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_options_header">
<code>werkzeug.http.parse_options_header(value, multiple=False)</code> </dt> <dd>
<p>Parse a <code>Content-Type</code> like header into a tuple with the content type and the options:</p> <pre data-language="python">&gt;&gt;&gt; parse_options_header('text/html; charset=utf8')
('text/html', {'charset': 'utf8'})
</pre> <p>This should not be used to parse <code>Cache-Control</code> like headers that use a slightly different format. For these headers use the <a class="reference internal" href="#werkzeug.http.parse_dict_header" title="werkzeug.http.parse_dict_header"><code>parse_dict_header()</code></a> function.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.15: </span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2231.html" id="index-4"><strong>RFC 2231</strong></a> parameter continuations are handled.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – the header to parse.</li> <li>
<strong>multiple</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – Whether try to parse and return multiple MIME types</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>(mimetype, options) or (mimetype, options, mimetype, options, …) if multiple=True</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Union[Tuple[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>, Dict[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>]], Tuple[Any, …]]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_set_header">
<code>werkzeug.http.parse_set_header(value, on_update=None)</code> </dt> <dd>
<p>Parse a set-like header and return a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet"><code>HeaderSet</code></a> object:</p> <pre data-language="python">&gt;&gt;&gt; hs = parse_set_header('token, "quoted value"')
</pre> <p>The return value is an object that treats the items case-insensitively and keeps the order of the items:</p> <pre data-language="python">&gt;&gt;&gt; 'TOKEN' in hs
True
&gt;&gt;&gt; hs.index('quoted value')
1
&gt;&gt;&gt; hs
HeaderSet(['token', 'quoted value'])
</pre> <p>To create a header from the <code>HeaderSet</code> again, use the <a class="reference internal" href="#werkzeug.http.dump_header" title="werkzeug.http.dump_header"><code>dump_header()</code></a> function.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – a set header to be parsed.</li> <li>
<strong>on_update</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet">werkzeug.datastructures.HeaderSet</a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><em>]</em><em>]</em>) – an optional callable that is called every time a value on the <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet"><code>HeaderSet</code></a> object is changed.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet"><code>HeaderSet</code></a></p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet">werkzeug.datastructures.HeaderSet</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_list_header">
<code>werkzeug.http.parse_list_header(value)</code> </dt> <dd>
<p>Parse lists as described by RFC 2068 Section 2.</p> <p>In particular, parse comma-separated lists where the elements of the list may include quoted-strings. A quoted-string could contain a comma. A non-quoted string could have quotes in the middle. Quotes are removed automatically after parsing.</p> <p>It basically works like <a class="reference internal" href="#werkzeug.http.parse_set_header" title="werkzeug.http.parse_set_header"><code>parse_set_header()</code></a> just that items may appear multiple times and case sensitivity is preserved.</p> <p>The return value is a standard <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code>list</code></a>:</p> <pre data-language="python">&gt;&gt;&gt; parse_list_header('token, "quoted value"')
['token', 'quoted value']
</pre> <p>To create a header from the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code>list</code></a> again, use the <a class="reference internal" href="#werkzeug.http.dump_header" title="werkzeug.http.dump_header"><code>dump_header()</code></a> function.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – a string with a list header.</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code>list</code></a></p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>List[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_dict_header">
<code>werkzeug.http.parse_dict_header(value, cls=&lt;class 'dict'&gt;)</code> </dt> <dd>
<p>Parse lists of key, value pairs as described by RFC 2068 Section 2 and convert them into a python dict (or any other mapping object created from the type with a dict like interface provided by the <code>cls</code> argument):</p> <pre data-language="python">&gt;&gt;&gt; d = parse_dict_header('foo="is a fish", bar="as well"')
&gt;&gt;&gt; type(d) is dict
True
&gt;&gt;&gt; sorted(d.items())
[('bar', 'as well'), ('foo', 'is a fish')]
</pre> <p>If there is no value for a key it will be <code>None</code>:</p> <pre data-language="python">&gt;&gt;&gt; parse_dict_header('key_without_value')
{'key_without_value': None}
</pre> <p>To create a header from the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code>dict</code></a> again, use the <a class="reference internal" href="#werkzeug.http.dump_header" title="werkzeug.http.dump_header"><code>dump_header()</code></a> function.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.9: </span>Added support for <code>cls</code> argument.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – a string with a dict header.</li> <li>
<strong>cls</strong> (<em>Type</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><em>]</em>) – callable to use for storage of parsed results.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>an instance of <code>cls</code></p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Dict[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_accept_header">
<code>werkzeug.http.parse_accept_header(value[, class])</code> </dt> <dd>
<p>Parses an HTTP Accept-* header. This does not implement a complete valid algorithm but one that supports at least value and quality extraction.</p> <p>Returns a new <code>Accept</code> object (basically a list of <code>(value, quality)</code> tuples sorted by the quality with some additional accessor methods).</p> <p>The second parameter can be a subclass of <code>Accept</code> that is created with the parsed values and returned.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – the accept header string to be parsed.</li> <li>
<strong>cls</strong> (<em>Optional</em><em>[</em><em>Type</em><em>[</em><em>werkzeug.http._TAnyAccept</em><em>]</em><em>]</em>) – the wrapper class for the return value (can be <code>Accept</code> or a subclass thereof)</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>an instance of <code>cls</code>.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>werkzeug.http._TAnyAccept</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_cache_control_header">
<code>werkzeug.http.parse_cache_control_header(value, on_update=None, cls=None)</code> </dt> <dd>
<p>Parse a cache control header. The RFC differs between response and request cache control, this method does not. It’s your responsibility to not use the wrong control statements.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5: </span>The <code>cls</code> was added. If not specified an immutable <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.RequestCacheControl" title="werkzeug.datastructures.RequestCacheControl"><code>RequestCacheControl</code></a> is returned.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – a cache control header to be parsed.</li> <li>
<strong>on_update</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><em>werkzeug.http._TAnyCC</em><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><em>]</em><em>]</em>) – an optional callable that is called every time a value on the <code>CacheControl</code> object is changed.</li> <li>
<strong>cls</strong> (<em>Optional</em><em>[</em><em>Type</em><em>[</em><em>werkzeug.http._TAnyCC</em><em>]</em><em>]</em>) – the class for the returned object. By default <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.RequestCacheControl" title="werkzeug.datastructures.RequestCacheControl"><code>RequestCacheControl</code></a> is used.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a <code>cls</code> object.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>werkzeug.http._TAnyCC</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_authorization_header">
<code>werkzeug.http.parse_authorization_header(value)</code> </dt> <dd>
<p>Parse an HTTP basic/digest authorization header transmitted by the web browser. The return value is either <code>None</code> if the header was invalid or not given, otherwise an <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Authorization" title="werkzeug.datastructures.Authorization"><code>Authorization</code></a> object.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – the authorization header to parse.</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Authorization" title="werkzeug.datastructures.Authorization"><code>Authorization</code></a> object or <code>None</code>.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Optional[<a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Authorization" title="werkzeug.datastructures.Authorization">werkzeug.datastructures.Authorization</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_www_authenticate_header">
<code>werkzeug.http.parse_www_authenticate_header(value, on_update=None)</code> </dt> <dd>
<p>Parse an HTTP WWW-Authenticate header into a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.WWWAuthenticate" title="werkzeug.datastructures.WWWAuthenticate"><code>WWWAuthenticate</code></a> object.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – a WWW-Authenticate header to parse.</li> <li>
<strong>on_update</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.WWWAuthenticate" title="werkzeug.datastructures.WWWAuthenticate">werkzeug.datastructures.WWWAuthenticate</a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><em>]</em><em>]</em>) – an optional callable that is called every time a value on the <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.WWWAuthenticate" title="werkzeug.datastructures.WWWAuthenticate"><code>WWWAuthenticate</code></a> object is changed.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.WWWAuthenticate" title="werkzeug.datastructures.WWWAuthenticate"><code>WWWAuthenticate</code></a> object.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.WWWAuthenticate" title="werkzeug.datastructures.WWWAuthenticate">werkzeug.datastructures.WWWAuthenticate</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_if_range_header">
<code>werkzeug.http.parse_if_range_header(value)</code> </dt> <dd>
<p>Parses an if-range header which can be an etag or a date. Returns a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.IfRange" title="werkzeug.datastructures.IfRange"><code>IfRange</code></a> object.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>If the value represents a datetime, it is timezone-aware.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – </p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.IfRange" title="werkzeug.datastructures.IfRange">werkzeug.datastructures.IfRange</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_range_header">
<code>werkzeug.http.parse_range_header(value, make_inclusive=True)</code> </dt> <dd>
<p>Parses a range header into a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Range" title="werkzeug.datastructures.Range"><code>Range</code></a> object. If the header is missing or malformed <code>None</code> is returned. <code>ranges</code> is a list of <code>(start, stop)</code> tuples where the ranges are non-inclusive.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – </li> <li>
<strong>make_inclusive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p>Optional[<a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Range" title="werkzeug.datastructures.Range">werkzeug.datastructures.Range</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_content_range_header">
<code>werkzeug.http.parse_content_range_header(value, on_update=None)</code> </dt> <dd>
<p>Parses a range header into a <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.ContentRange"><code>ContentRange</code></a> object or <code>None</code> if parsing is not possible.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – a content range header to be parsed.</li> <li>
<strong>on_update</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.ContentRange">werkzeug.datastructures.ContentRange</a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><em>]</em><em>]</em>) – an optional callable that is called every time a value on the <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.ContentRange"><code>ContentRange</code></a> object is changed.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p>Optional[<a class="reference internal" href="../datastructures/index#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.ContentRange">werkzeug.datastructures.ContentRange</a>]</p> </dd> </dl> </dd>
</dl> </section> <section id="header-utilities"> <h2>Header Utilities</h2> <p>The following utilities operate on HTTP headers well but do not parse them. They are useful if you’re dealing with conditional responses or if you want to proxy arbitrary requests but want to remove WSGI-unsupported hop-by-hop headers. Also there is a function to create HTTP header strings from the parsed data.</p> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_entity_header">
<code>werkzeug.http.is_entity_header(header)</code> </dt> <dd>
<p>Check if a header is an entity header.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the header to test.</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p><code>True</code> if it’s an entity header, <code>False</code> otherwise.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_hop_by_hop_header">
<code>werkzeug.http.is_hop_by_hop_header(header)</code> </dt> <dd>
<p>Check if a header is an HTTP/1.1 “Hop-by-Hop” header.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the header to test.</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p><code>True</code> if it’s an HTTP/1.1 “Hop-by-Hop” header, <code>False</code> otherwise.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.remove_entity_headers">
<code>werkzeug.http.remove_entity_headers(headers, allowed=('expires', 'content-location'))</code> </dt> <dd>
<p>Remove all entity headers from a list or <code>Headers</code> object. This operation works in-place. <code>Expires</code> and <code>Content-Location</code> headers are by default not removed. The reason for this is <a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html" id="index-5"><strong>RFC 2616</strong></a> section 10.3.5 which specifies some entity headers that should be sent.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.5: </span>added <code>allowed</code> parameter.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>headers</strong> (<em>Union</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Headers" title="werkzeug.datastructures.Headers">werkzeug.datastructures.Headers</a><em>, </em><em>List</em><em>[</em><em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em><em>]</em><em>]</em>) – a list or <code>Headers</code> object.</li> <li>
<strong>allowed</strong> (<em>Iterable</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – a list of headers that should still be allowed even though they are entity headers.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.remove_hop_by_hop_headers">
<code>werkzeug.http.remove_hop_by_hop_headers(headers)</code> </dt> <dd>
<p>Remove all HTTP/1.1 “Hop-by-Hop” headers from a list or <code>Headers</code> object. This operation works in-place.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>headers</strong> (<em>Union</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.Headers" title="werkzeug.datastructures.Headers">werkzeug.datastructures.Headers</a><em>, </em><em>List</em><em>[</em><em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em><em>]</em><em>]</em>) – a list or <code>Headers</code> object.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_byte_range_valid">
<code>werkzeug.http.is_byte_range_valid(start, stop, length)</code> </dt> <dd>
<p>Checks if a given byte content range is valid for the given length.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>start</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – </li> <li>
<strong>stop</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – </li> <li>
<strong>length</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.quote_header_value">
<code>werkzeug.http.quote_header_value(value, extra_chars='', allow_token=True)</code> </dt> <dd>
<p>Quote a header value if necessary.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – the value to quote.</li> <li>
<strong>extra_chars</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – a list of extra characters to skip quoting.</li> <li>
<strong>allow_token</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – if this is enabled token values are returned unchanged.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.unquote_header_value">
<code>werkzeug.http.unquote_header_value(value, is_filename=False)</code> </dt> <dd>
<p>Unquotes a header value. (Reversal of <a class="reference internal" href="#werkzeug.http.quote_header_value" title="werkzeug.http.quote_header_value"><code>quote_header_value()</code></a>). This does not use the real unquoting but what browsers are actually using for quoting.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the header value to unquote.</li> <li>
<strong>is_filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – The value represents a filename or path.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.dump_header">
<code>werkzeug.http.dump_header(iterable, allow_token=True)</code> </dt> <dd>
<p>Dump an HTTP header again. This is the reversal of <a class="reference internal" href="#werkzeug.http.parse_list_header" title="werkzeug.http.parse_list_header"><code>parse_list_header()</code></a>, <a class="reference internal" href="#werkzeug.http.parse_set_header" title="werkzeug.http.parse_set_header"><code>parse_set_header()</code></a> and <a class="reference internal" href="#werkzeug.http.parse_dict_header" title="werkzeug.http.parse_dict_header"><code>parse_dict_header()</code></a>. This also quotes strings that include an equals sign unless you pass it as dict of key, value pairs.</p> <pre data-language="python">&gt;&gt;&gt; dump_header({'foo': 'bar baz'})
'foo="bar baz"'
&gt;&gt;&gt; dump_header(('foo', 'bar baz'))
'foo, "bar baz"'
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>iterable</strong> (<em>Union</em><em>[</em><em>Dict</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em><em>]</em><em>, </em><em>Iterable</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em><em>]</em>) – the iterable or dict of values to quote.</li> <li>
<strong>allow_token</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – if set to <code>False</code> tokens as values are disallowed. See <a class="reference internal" href="#werkzeug.http.quote_header_value" title="werkzeug.http.quote_header_value"><code>quote_header_value()</code></a> for more details.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> </section> <section id="cookies"> <h2>Cookies</h2> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_cookie">
<code>werkzeug.http.parse_cookie(header, charset='utf-8', errors='replace', cls=None)</code> </dt> <dd>
<p>Parse a cookie from a string or WSGI environ.</p> <p>The same key can be provided multiple times, the values are stored in-order. The default <code>MultiDict</code> will have the first value first, and all values can be retrieved with <code>MultiDict.getlist()</code>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>header</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>WSGIEnvironment</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>]</em><em>]</em>) – The cookie header as a string, or a WSGI environ dict with a <code>HTTP_COOKIE</code> key.</li> <li>
<strong>charset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The charset for the cookie values.</li> <li>
<strong>errors</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The error behavior for the charset decoding.</li> <li>
<strong>cls</strong> (<em>Optional</em><em>[</em><em>Type</em><em>[</em><em>ds.MultiDict</em><em>]</em><em>]</em>) – A dict-like class to store the parsed cookies in. Defaults to <code>MultiDict</code>.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p>ds.MultiDict[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>]</p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 1.0.0: </span>Returns a <code>MultiDict</code> instead of a <code>TypeConversionDict</code>.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.5: </span>Returns a <code>TypeConversionDict</code> instead of a regular dict. The <code>cls</code> parameter was added.</p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.dump_cookie">
<code>werkzeug.http.dump_cookie(key, value='', max_age=None, expires=None, path='/', domain=None, secure=False, httponly=False, charset='utf-8', sync_expires=True, max_size=4093, samesite=None)</code> </dt> <dd>
<p>Create a Set-Cookie header without the <code>Set-Cookie</code> prefix.</p> <p>The return value is usually restricted to ascii as the vast majority of values are properly escaped, but that is no guarantee. It’s tunneled through latin1 as required by <a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333" id="index-6"><strong>PEP 3333</strong></a>.</p> <p>The return value is not ASCII safe if the key contains unicode characters. This is technically against the specification but happens in the wild. It’s strongly recommended to not use non-ASCII values for the keys.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>max_age</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.9)">datetime.timedelta</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em><em>]</em>) – should be a number of seconds, or <code>None</code> (default) if the cookie should last only as long as the client’s browser session. Additionally <code>timedelta</code> objects are accepted, too.</li> <li>
<strong>expires</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)">datetime.datetime</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><em>]</em><em>]</em>) – should be a <code>datetime</code> object or unix timestamp.</li> <li>
<strong>path</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – limits the cookie to a given path, per default it will span the whole domain.</li> <li>
<strong>domain</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – Use this if you want to set a cross-domain cookie. For example, <code>domain=".example.com"</code> will set a cookie that is readable by the domain <code>www.example.com</code>, <code>foo.example.com</code> etc. Otherwise, a cookie will only be readable by the domain that set it.</li> <li>
<strong>secure</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – The cookie will only be available via HTTPS</li> <li>
<strong>httponly</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – disallow JavaScript to access the cookie. This is an extension to the cookie standard and probably not supported by all browsers.</li> <li>
<strong>charset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the encoding for string values.</li> <li>
<strong>sync_expires</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – automatically set expires if max_age is defined but expires not.</li> <li>
<strong>max_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a>) – Warn if the final header value exceeds this size. The default, 4093, should be safely <a class="reference external" href="http://browsercookielimits.squawky.net/">supported by most browsers</a>. Set to 0 to disable this check.</li> <li>
<strong>samesite</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – Limits the scope of the cookie such that it will only be attached to requests if those requests are same-site.</li> <li>
<strong>key</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – </li> <li>
<strong>value</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 1.0.0: </span>The string <code>'None'</code> is accepted for <code>samesite</code>.</p> </div> </details>
</dd>
</dl> </section> <section id="conditional-response-helpers"> <h2>Conditional Response Helpers</h2> <p>For conditional responses the following functions might be useful:</p> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_etags">
<code>werkzeug.http.parse_etags(value)</code> </dt> <dd>
<p>Parse an etag header.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>value</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – the tag header to parse</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>an <a class="reference internal" href="../datastructures/index#werkzeug.datastructures.ETags" title="werkzeug.datastructures.ETags"><code>ETags</code></a> object.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.ETags" title="werkzeug.datastructures.ETags">werkzeug.datastructures.ETags</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.quote_etag">
<code>werkzeug.http.quote_etag(etag, weak=False)</code> </dt> <dd>
<p>Quote an etag.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>etag</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the etag to quote.</li> <li>
<strong>weak</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – set to <code>True</code> to tag it “weak”.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.unquote_etag">
<code>werkzeug.http.unquote_etag(etag)</code> </dt> <dd>
<p>Unquote a single etag:</p> <pre data-language="python">&gt;&gt;&gt; unquote_etag('W/"bar"')
('bar', True)
&gt;&gt;&gt; unquote_etag('"bar"')
('bar', False)
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>etag</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – the etag identifier to unquote.</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a <code>(etag, weak)</code> tuple.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Union[Tuple[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>], Tuple[<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a>, <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a>]]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.generate_etag">
<code>werkzeug.http.generate_etag(data)</code> </dt> <dd>
<p>Generate an etag for some data.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Use SHA-1. MD5 may not be available in some environments.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a>) – </p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_resource_modified">
<code>werkzeug.http.is_resource_modified(environ, etag=None, data=None, last_modified=None, ignore_if_range=True)</code> </dt> <dd>
<p>Convenience method for conditional requests.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>environ</strong> (<em>WSGIEnvironment</em>) – the WSGI environment of the request to be checked.</li> <li>
<strong>etag</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – the etag for the response for comparison.</li> <li>
<strong>data</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>]</em>) – or alternatively the data of the response to automatically generate an etag using <a class="reference internal" href="#werkzeug.http.generate_etag" title="werkzeug.http.generate_etag"><code>generate_etag()</code></a>.</li> <li>
<strong>last_modified</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)">datetime.datetime</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em><em>]</em>) – an optional date of the last modification.</li> <li>
<strong>ignore_if_range</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – If <code>False</code>, <code>If-Range</code> header will be taken into account.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p><code>True</code> if the resource was modified, otherwise <code>False</code>.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>SHA-1 is used to generate an etag value for the data. MD5 may not be available in some environments.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 1.0.0: </span>The check is run for methods other than <code>GET</code> and <code>HEAD</code>.</p> </div> </details>
</dd>
</dl> </section> <section id="constants"> <h2>Constants</h2> <dl class="py data"> <dt class="sig sig-object py" id="werkzeug.http.HTTP_STATUS_CODES">
<code>werkzeug.http.HTTP_STATUS_CODES</code> </dt> <dd>
<p>A dict of status code -&gt; default status message pairs. This is used by the wrappers and other places where an integer status code is expanded to a string throughout Werkzeug.</p> </dd>
</dl> </section> <section id="module-werkzeug.formparser"> <h2 id="form-data-parsing">Form Data Parsing</h2> <p>Werkzeug provides the form parsing functions separately from the request object so that you can access form data from a plain WSGI environment.</p> <p>The following formats are currently supported by the form data parser:</p> <ul class="simple"> <li><code>application/x-www-form-urlencoded</code></li> <li><code>multipart/form-data</code></li> </ul> <p>Nested multipart is not currently supported (Werkzeug 0.9), but it isn’t used by any of the modern web browsers.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from io import BytesIO
&gt;&gt;&gt; from werkzeug.formparser import parse_form_data
&gt;&gt;&gt; data = (
...     b'--foo\r\nContent-Disposition: form-data; name="test"\r\n'
...     b"\r\nHello World!\r\n--foo--"
... )
&gt;&gt;&gt; environ = {
...     "wsgi.input": BytesIO(data),
...     "CONTENT_LENGTH": str(len(data)),
...     "CONTENT_TYPE": "multipart/form-data; boundary=foo",
...     "REQUEST_METHOD": "POST",
... }
&gt;&gt;&gt; stream, form, files = parse_form_data(environ)
&gt;&gt;&gt; stream.read()
b''
&gt;&gt;&gt; form['test']
'Hello World!'
&gt;&gt;&gt; not files
True
</pre> <p>Normally the WSGI environment is provided by the WSGI gateway with the incoming data as part of it. If you want to generate such fake-WSGI environments for unittesting you might want to use the <code>create_environ()</code> function or the <code>EnvironBuilder</code> instead.</p> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.formparser.FormDataParser">
<code>class werkzeug.formparser.FormDataParser(stream_factory=None, charset='utf-8', errors='replace', max_form_memory_size=None, max_content_length=None, cls=None, silent=True)</code> </dt> <dd>
<p>This class implements parsing of form data for Werkzeug. By itself it can parse multipart and url encoded form data. It can be subclassed and extended but for most mimetypes it is a better idea to use the untouched stream and expose it as separate attributes on a request object.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.8.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>stream_factory</strong> (<em>Optional</em><em>[</em><em>TStreamFactory</em><em>]</em>) – An optional callable that returns a new read and writeable file descriptor. This callable works the same as <code>Response._get_file_stream()</code>.</li> <li>
<strong>charset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The character set for URL and url encoded form data.</li> <li>
<strong>errors</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The encoding error behavior.</li> <li>
<strong>max_form_memory_size</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – the maximum number of bytes to be accepted for in-memory stored form data. If the data exceeds the value specified an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>max_content_length</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – If this is provided and the transmitted data is longer than this value an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>cls</strong> (<em>Optional</em><em>[</em><em>Type</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.MultiDict" title="werkzeug.datastructures.MultiDict">werkzeug.datastructures.MultiDict</a><em>]</em><em>]</em>) – an optional dict class to use. If this is not specified or <code>None</code> the default <code>MultiDict</code> is used.</li> <li>
<strong>silent</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – If set to False parsing errors will not be caught.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.formparser.parse_form_data">
<code>werkzeug.formparser.parse_form_data(environ, stream_factory=None, charset='utf-8', errors='replace', max_form_memory_size=None, max_content_length=None, cls=None, silent=True)</code> </dt> <dd>
<p>Parse the form data in the environ and return it as tuple in the form <code>(stream, form, files)</code>. You should only call this method if the transport method is <code>POST</code>, <code>PUT</code>, or <code>PATCH</code>.</p> <p>If the mimetype of the data transmitted is <code>multipart/form-data</code> the files multidict will be filled with <code>FileStorage</code> objects. If the mimetype is unknown the input stream is wrapped and returned as first argument, else the stream is empty.</p> <p>This is a shortcut for the common usage of <a class="reference internal" href="#werkzeug.formparser.FormDataParser" title="werkzeug.formparser.FormDataParser"><code>FormDataParser</code></a>.</p> <p>Have a look at <a class="reference internal" href="../request_data/index"><span class="doc">Dealing with Request Data</span></a> for more details.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.1: </span>The optional <code>silent</code> flag was added.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.5: </span>The <code>max_form_memory_size</code>, <code>max_content_length</code> and <code>cls</code> parameters were added.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>environ</strong> (<em>WSGIEnvironment</em>) – the WSGI environment to be used for parsing.</li> <li>
<strong>stream_factory</strong> (<em>Optional</em><em>[</em><em>TStreamFactory</em><em>]</em>) – An optional callable that returns a new read and writeable file descriptor. This callable works the same as <code>Response._get_file_stream()</code>.</li> <li>
<strong>charset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The character set for URL and url encoded form data.</li> <li>
<strong>errors</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The encoding error behavior.</li> <li>
<strong>max_form_memory_size</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – the maximum number of bytes to be accepted for in-memory stored form data. If the data exceeds the value specified an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>max_content_length</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – If this is provided and the transmitted data is longer than this value an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>cls</strong> (<em>Optional</em><em>[</em><em>Type</em><em>[</em><a class="reference internal" href="../datastructures/index#werkzeug.datastructures.MultiDict" title="werkzeug.datastructures.MultiDict">werkzeug.datastructures.MultiDict</a><em>]</em><em>]</em>) – an optional dict class to use. If this is not specified or <code>None</code> the default <code>MultiDict</code> is used.</li> <li>
<strong>silent</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – If set to False parsing errors will not be caught.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A tuple in the form <code>(stream, form, files)</code>.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>t_parse_result</p> </dd> </dl> </dd>
</dl> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2021 Pallets<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://werkzeug.palletsprojects.com/en/2.0.x/http/" class="_attribution-link">https://werkzeug.palletsprojects.com/en/2.0.x/http/</a>
  </p>
</div>

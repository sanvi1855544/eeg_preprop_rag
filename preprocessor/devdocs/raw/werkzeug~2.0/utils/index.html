<h1>Utilities</h1> <p>Various utility functions shipped with Werkzeug.</p> <section id="module-werkzeug.utils"> <h2 id="html-helpers">HTML Helpers</h2> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.utils.HTMLBuilder">
<code>class werkzeug.utils.HTMLBuilder(dialect)</code> </dt> <dd>
<p>Helper object for HTML generation.</p> <p>Per default there are two instances of that class. The <code>html</code> one, and the <code>xhtml</code> one for those two dialects. The class uses keyword parameters and positional parameters to generate small snippets of HTML.</p> <p>Keyword parameters are converted to XML/SGML attributes, positional arguments are used as children. Because Python accepts positional arguments before keyword arguments it’s a good idea to use a list with the star-syntax for some children:</p> <pre data-language="python">&gt;&gt;&gt; html.p(class_='foo', *[html.a('foo', href='foo.html'), ' ',
...                        html.a('bar', href='bar.html')])
'&lt;p class="foo"&gt;&lt;a href="foo.html"&gt;foo&lt;/a&gt; &lt;a href="bar.html"&gt;bar&lt;/a&gt;&lt;/p&gt;'
</pre> <p>This class works around some browser limitations and can not be used for arbitrary SGML/XML generation. For that purpose lxml and similar libraries exist.</p> <p>Calling the builder escapes the string passed:</p> <pre data-language="python">&gt;&gt;&gt; html.p(html("&lt;foo&gt;"))
'&lt;p&gt;&amp;lt;foo&amp;gt;&lt;/p&gt;'
</pre> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1.</p> </div> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.escape">
<code>werkzeug.utils.escape(s)</code> </dt> <dd>
<p>Replace <code>&amp;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>"</code>, and <code>'</code> with HTML-safe sequences.</p> <p><code>None</code> is escaped to an empty string.</p> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use MarkupSafe instead.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>s</strong> (<em>Any</em>) – </p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.unescape">
<code>werkzeug.utils.unescape(s)</code> </dt> <dd>
<p>The reverse of <a class="reference internal" href="#werkzeug.utils.escape" title="werkzeug.utils.escape"><code>escape()</code></a>. This unescapes all the HTML entities, not only those inserted by <code>escape</code>.</p> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use MarkupSafe instead.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>s</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – </p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> </section> <section id="general-helpers"> <h2>General Helpers</h2> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.utils.cached_property">
<code>class werkzeug.utils.cached_property(fget, name=None, doc=None)</code> </dt> <dd>
<p>A <code>property()</code> that is only evaluated once. Subsequent access returns the cached value. Setting the property sets the cached value. Deleting the property clears the cached value, accessing it again will evaluate it again.</p> <pre data-language="python">class Example:
    @cached_property
    def value(self):
        # calculate something important here
        return 42

e = Example()
e.value  # evaluates
e.value  # uses cache
e.value = 16  # sets cache
del e.value  # clears cache
</pre> <p>The class must have a <code>__dict__</code> for this to work.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span><code>del obj.name</code> clears the cached value.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>fget</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>]</em><em>, </em><em>Any</em><em>]</em>) – </li> <li>
<strong>name</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – </li> <li>
<strong>doc</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.invalidate_cached_property">
<code>werkzeug.utils.invalidate_cached_property(obj, name)</code> </dt> <dd>
<p>Invalidates the cache for a <a class="reference internal" href="#werkzeug.utils.cached_property" title="werkzeug.utils.cached_property"><code>cached_property</code></a>:</p> <pre data-language="python">&gt;&gt;&gt; class Test(object):
...     @cached_property
...     def magic_number(self):
...         print("recalculating...")
...         return 42
...
&gt;&gt;&gt; var = Test()
&gt;&gt;&gt; var.magic_number
recalculating...
42
&gt;&gt;&gt; var.magic_number
42
&gt;&gt;&gt; invalidate_cached_property(var, "magic_number")
&gt;&gt;&gt; var.magic_number
recalculating...
42
</pre> <p>You must pass the name of the cached property as the second argument.</p> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <code>del obj.name</code> instead.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>obj</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)">object</a>) – </li> <li>
<strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.utils.environ_property">
<code>class werkzeug.utils.environ_property(name, default=None, load_func=None, dump_func=None, read_only=None, doc=None)</code> </dt> <dd>
<p>Maps request attributes to environment variables. This works not only for the Werkzeug request object, but also any other class with an environ attribute:</p> <pre data-language="python">&gt;&gt;&gt; class Test(object):
...     environ = {'key': 'value'}
...     test = environ_property('key')
&gt;&gt;&gt; var = Test()
&gt;&gt;&gt; var.test
'value'
</pre> <p>If you pass it a second value it’s used as default if the key does not exist, the third one can be a converter that takes a value and converts it. If it raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.9)"><code>ValueError</code></a> or <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.9)"><code>TypeError</code></a> the default value is used. If no default value is provided <code>None</code> is used.</p> <p>Per default the property is read only. You have to explicitly enable it by passing <code>read_only=False</code> to the constructor.</p> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.utils.header_property">
<code>class werkzeug.utils.header_property(name, default=None, load_func=None, dump_func=None, read_only=None, doc=None)</code> </dt> <dd>
<p>Like <code>environ_property</code> but for headers.</p> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.redirect">
<code>werkzeug.utils.redirect(location, code=302, Response=None)</code> </dt> <dd>
<p>Returns a response object (a WSGI application) that, if called, redirects the client to the target location. Supported codes are 301, 302, 303, 305, 307, and 308. 300 is not supported because it’s not a real redirect and 304 because it’s the answer for a request with a request with defined If-Modified-Since headers.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.10: </span>The class used for the Response object can now be passed in.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.6: </span>The location can now be a unicode string that is encoded using the <code>iri_to_uri()</code> function.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>location</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the location the response should redirect to.</li> <li>
<strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a>) – the redirect status code. defaults to 302.</li> <li>
<strong>Response</strong> (<em>class</em>) – a Response class to use when instantiating a response. The default is <a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Response" title="werkzeug.wrappers.Response"><code>werkzeug.wrappers.Response</code></a> if unspecified.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Response" title="werkzeug.wrappers.Response">Response</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.append_slash_redirect">
<code>werkzeug.utils.append_slash_redirect(environ, code=301)</code> </dt> <dd>
<p>Redirects to the same URL but with a slash appended. The behavior of this function is undefined if the path ends with a slash already.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>environ</strong> (<em>WSGIEnvironment</em>) – the WSGI environment for the request that triggers the redirect.</li> <li>
<strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a>) – the status code for the redirect.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Response" title="werkzeug.wrappers.Response">Response</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.send_file">
<code>werkzeug.utils.send_file(path_or_file, environ, mimetype=None, as_attachment=False, download_name=None, conditional=True, etag=True, last_modified=None, max_age=None, use_x_sendfile=False, response_class=None, _root_path=None)</code> </dt> <dd>
<p>Send the contents of a file to the client.</p> <p>The first argument can be a file path or a file-like object. Paths are preferred in most cases because Werkzeug can manage the file and get extra information from the path. Passing a file-like object requires that the file is opened in binary mode, and is mostly useful when building a file in memory with <a class="reference external" href="https://docs.python.org/3/library/io.html#io.BytesIO" title="(in Python v3.9)"><code>io.BytesIO</code></a>.</p> <p>Never pass file paths provided by a user. The path is assumed to be trusted, so a user could craft a path to access a file you didn’t intend.</p> <p>If the WSGI server sets a <code>file_wrapper</code> in <code>environ</code>, it is used, otherwise Werkzeug’s built-in wrapper is used. Alternatively, if the HTTP server supports <code>X-Sendfile</code>, <code>use_x_sendfile=True</code> will tell the server to send the given path, which is much more efficient than reading it in Python.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>path_or_file</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)">os.PathLike</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><em>BinaryIO</em><em>]</em>) – The path to the file to send, relative to the current working directory if a relative path is given. Alternatively, a file-like object opened in binary mode. Make sure the file pointer is seeked to the start of the data.</li> <li>
<strong>environ</strong> (<em>WSGIEnvironment</em>) – The WSGI environ for the current request.</li> <li>
<strong>mimetype</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – The MIME type to send for the file. If not provided, it will try to detect it from the file name.</li> <li>
<strong>as_attachment</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – Indicate to a browser that it should offer to save the file instead of displaying it.</li> <li>
<strong>download_name</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – The default name browsers will use when saving the file. Defaults to the passed file name.</li> <li>
<strong>conditional</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – Enable conditional and range responses based on request headers. Requires passing a file path and <code>environ</code>.</li> <li>
<strong>etag</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em>) – Calculate an ETag for the file, which requires passing a file path. Can also be a string to use instead.</li> <li>
<strong>last_modified</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)">datetime.datetime</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a><em>]</em><em>]</em>) – The last modified time to send for the file, in seconds. If not provided, it will try to detect it from the file path.</li> <li>
<strong>max_age</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>, </em><em>Callable</em><em>[</em><em>[</em><em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)">os.PathLike</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em><em>]</em><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em><em>]</em><em>]</em>) – How long the client should cache the file, in seconds. If set, <code>Cache-Control</code> will be <code>public</code>, otherwise it will be <code>no-cache</code> to prefer conditional caching.</li> <li>
<strong>use_x_sendfile</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – Set the <code>X-Sendfile</code> header to let the server to efficiently send the file. Requires support from the HTTP server. Requires passing a file path.</li> <li>
<strong>response_class</strong> (<em>Optional</em><em>[</em><em>Type</em><em>[</em><a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Response" title="werkzeug.wrappers.Response">Response</a><em>]</em><em>]</em>) – Build the response using this class. Defaults to <a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Response" title="werkzeug.wrappers.Response"><code>Response</code></a>.</li> <li>
<strong>_root_path</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.9)">os.PathLike</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>]</em><em>]</em>) – Do not use. For internal use only. Use <code>send_from_directory()</code> to safely send files under a path.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Response" title="werkzeug.wrappers.Response">Response</a></p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2.0: </span>Adapted from Flask’s implementation.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span><code>download_name</code> replaces Flask’s <code>attachment_filename</code> parameter. If <code>as_attachment=False</code>, it is passed with <code>Content-Disposition: inline</code> instead.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span><code>max_age</code> replaces Flask’s <code>cache_timeout</code> parameter. <code>conditional</code> is enabled and <code>max_age</code> is not set by default.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span><code>etag</code> replaces Flask’s <code>add_etags</code> parameter. It can be a string to use instead of generating one.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>If an encoding is returned when guessing <code>mimetype</code> from <code>download_name</code>, set the <code>Content-Encoding</code> header.</p> </div> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.import_string">
<code>werkzeug.utils.import_string(import_name, silent=False)</code> </dt> <dd>
<p>Imports an object based on a string. This is useful if you want to use import paths as endpoints or something similar. An import path can be specified either in dotted notation (<code>xml.sax.saxutils.escape</code>) or with a colon as object delimiter (<code>xml.sax.saxutils:escape</code>).</p> <p>If <code>silent</code> is True the return value will be <code>None</code> if the import fails.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>import_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the dotted name for the object to import.</li> <li>
<strong>silent</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – if set to <code>True</code> import errors are ignored and <code>None</code> is returned instead.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>imported object</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Any</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.find_modules">
<code>werkzeug.utils.find_modules(import_path, include_packages=False, recursive=False)</code> </dt> <dd>
<p>Finds all the modules below a package. This can be useful to automatically import all views / controllers so that their metaclasses / function decorators have a chance to register themselves on the application.</p> <p>Packages are not returned unless <code>include_packages</code> is <code>True</code>. This can also recursively list modules but in that case it will import all the packages to get the correct load path of that module.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>import_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the dotted name for the package to find child modules.</li> <li>
<strong>include_packages</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – set to <code>True</code> if packages should be returned, too.</li> <li>
<strong>recursive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a>) – set to <code>True</code> if recursion should happen.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>generator</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Iterator[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.validate_arguments">
<code>werkzeug.utils.validate_arguments(func, args, kwargs, drop_extra=True)</code> </dt> <dd>
<p>Checks if the function accepts the arguments and keyword arguments. Returns a new <code>(args, kwargs)</code> tuple that can safely be passed to the function without causing a <code>TypeError</code> because the function signature is incompatible. If <code>drop_extra</code> is set to <code>True</code> (which is the default) any extra positional or keyword arguments are dropped automatically.</p> <p>The exception raised provides three attributes:</p> <dl class="simple"> <dt>
<code>missing</code> </dt>
<dd>
<p>A set of argument names that the function expected but where missing.</p> </dd> <dt>
<code>extra</code> </dt>
<dd>
<p>A dict of keyword arguments that the function can not handle but where provided.</p> </dd> <dt>
<code>extra_positional</code> </dt>
<dd>
<p>A list of values that where given by positional argument but the function cannot accept.</p> </dd> </dl> <p>This can be useful for decorators that forward user submitted data to a view function:</p> <pre data-language="python">from werkzeug.utils import ArgumentValidationError, validate_arguments

def sanitize(f):
    def proxy(request):
        data = request.values.to_dict()
        try:
            args, kwargs = validate_arguments(f, (request,), data)
        except ArgumentValidationError:
            raise BadRequest('The browser failed to transmit all '
                             'the data expected.')
        return f(*args, **kwargs)
    return proxy
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>func</strong> – the function the validation is performed against.</li> <li>
<strong>args</strong> – a tuple of positional arguments.</li> <li>
<strong>kwargs</strong> – a dict of keyword arguments.</li> <li>
<strong>drop_extra</strong> – set to <code>False</code> if you don’t want extra arguments to be silently dropped.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>tuple in the form <code>(args, kwargs)</code>.</p> </dd> </dl> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <a class="reference external" href="https://docs.python.org/3/library/inspect.html#inspect.signature" title="(in Python v3.9)"><code>inspect.signature()</code></a> instead.</p> </div> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.secure_filename">
<code>werkzeug.utils.secure_filename(filename)</code> </dt> <dd>
<p>Pass it a filename and it will return a secure version of it. This filename can then safely be stored on a regular file system and passed to <a class="reference external" href="https://docs.python.org/3/library/os.path.html#os.path.join" title="(in Python v3.9)"><code>os.path.join()</code></a>. The filename returned is an ASCII only string for maximum portability.</p> <p>On windows systems the function also makes sure that the file is not named after one of the special device files.</p> <pre data-language="python">&gt;&gt;&gt; secure_filename("My cool movie.mov")
'My_cool_movie.mov'
&gt;&gt;&gt; secure_filename("../../../etc/passwd")
'etc_passwd'
&gt;&gt;&gt; secure_filename('i contain cool \xfcml\xe4uts.txt')
'i_contain_cool_umlauts.txt'
</pre> <p>The function might return an empty filename. It’s your responsibility to ensure that the filename is unique and that you abort or generate a random filename if the function returned an empty one.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the filename to secure</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.utils.bind_arguments">
<code>werkzeug.utils.bind_arguments(func, args, kwargs)</code> </dt> <dd>
<p>Bind the arguments provided into a dict. When passed a function, a tuple of arguments and a dict of keyword arguments <code>bind_arguments</code> returns a dict of names as the function would see it. This can be useful to implement a cache decorator that uses the function arguments to build the cache key based on the values of the arguments.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>func</strong> – the function the arguments should be bound for.</li> <li>
<strong>args</strong> – tuple of positional arguments.</li> <li>
<strong>kwargs</strong> – a dict of keyword arguments.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code>dict</code></a> of bound keyword arguments.</p> </dd> </dl> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <code>Signature.bind()</code> instead.</p> </div> </dd>
</dl> </section> <section id="url-helpers"> <h2>URL Helpers</h2> <p>Please refer to <a class="reference internal" href="../urls/index"><span class="doc">URL Helpers</span></a>.</p> </section> <section id="module-werkzeug.user_agent"> <h2 id="user-agent-api">User Agent API</h2> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent">
<code>class werkzeug.user_agent.UserAgent(string)</code> </dt> <dd>
<p>Represents a parsed user agent header value.</p> <p>The default implementation does no parsing, only the <a class="reference internal" href="#werkzeug.user_agent.UserAgent.string" title="werkzeug.user_agent.UserAgent.string"><code>string</code></a> attribute is set. A subclass may parse the string to set the common attributes or expose other information. Set <a class="reference internal" href="../wrappers/index#werkzeug.wrappers.Request.user_agent_class" title="werkzeug.wrappers.Request.user_agent_class"><code>werkzeug.wrappers.Request.user_agent_class</code></a> to use a subclass.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>string</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The header value to parse.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2.0: </span>This replaces the previous <code>useragents</code> module, but does not provide a built-in parser.</p> </div> <dl class="py attribute"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent.platform">
<code>platform: Optional[str] = None</code> </dt> <dd>
<p>The OS name, if it could be parsed from the string.</p> </dd>
</dl> <dl class="py attribute"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent.browser">
<code>browser: Optional[str] = None</code> </dt> <dd>
<p>The browser name, if it could be parsed from the string.</p> </dd>
</dl> <dl class="py attribute"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent.version">
<code>version: Optional[str] = None</code> </dt> <dd>
<p>The browser version, if it could be parsed from the string.</p> </dd>
</dl> <dl class="py attribute"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent.language">
<code>language: Optional[str] = None</code> </dt> <dd>
<p>The browser language, if it could be parsed from the string.</p> </dd>
</dl> <dl class="py attribute"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent.string">
<code>string: str</code> </dt> <dd>
<p>The original header value.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="werkzeug.user_agent.UserAgent.to_header">
<code>to_header()</code> </dt> <dd>
<p>Convert to a header value.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> </dd>
</dl> </section> <section id="module-werkzeug.useragents"> <h2 id="useragent-parsing-deprecated">UserAgent Parsing (deprecated)</h2> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>This module will be removed in Werkzeug 2.1. Subclass <a class="reference internal" href="#werkzeug.user_agent.UserAgent" title="werkzeug.user_agent.UserAgent"><code>werkzeug.user_agent.UserAgent</code></a> to use a dedicated parser instead.</p> </div> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.useragents.UserAgent">
<code>class werkzeug.useragents.UserAgent(environ_or_string)</code> </dt> <dd>
<p>Represents a parsed user agent header value.</p> <p>This uses a basic parser to try to extract some information from the header.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>environ_or_string</strong> (<em>t.Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><em>WSGIEnvironment</em><em>]</em>) – The header value to parse, or a WSGI environ containing the header.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> </dl> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Subclass <a class="reference internal" href="#werkzeug.user_agent.UserAgent" title="werkzeug.user_agent.UserAgent"><code>werkzeug.user_agent.UserAgent</code></a> (note the new module name) to use a dedicated parser instead.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Passing a WSGI environ is deprecated and will be removed in 2.1.</p> </div> <dl class="py method"> <dt class="sig sig-object py" id="werkzeug.useragents.UserAgent.to_header">
<code>to_header()</code> </dt> <dd>
<p>Convert to a header value.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> </dd>
</dl> </section> <section id="module-werkzeug.security"> <h2 id="security-helpers">Security Helpers</h2> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.6.1.</span></p> </div> </details><dl class="py function"> <dt class="sig sig-object py" id="werkzeug.security.generate_password_hash">
<code>werkzeug.security.generate_password_hash(password, method='pbkdf2:sha256', salt_length=16)</code> </dt> <dd>
<p>Hash a password with the given method and salt with a string of the given length. The format of the string returned includes the method that was used so that <a class="reference internal" href="#werkzeug.security.check_password_hash" title="werkzeug.security.check_password_hash"><code>check_password_hash()</code></a> can check the hash.</p> <p>The format for the hashed string looks like this:</p> <pre data-language="python">method$salt$hash
</pre> <p>This method can <strong>not</strong> generate unsalted passwords but it is possible to set param method=’plain’ in order to enforce plaintext passwords. If a salt is used, hmac is used internally to salt the password.</p> <p>If PBKDF2 is wanted it can be enabled by setting the method to <code>pbkdf2:method:iterations</code> where iterations is optional:</p> <pre data-language="python">pbkdf2:sha256:80000$salt$hash
pbkdf2:sha256$salt$hash
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the password to hash.</li> <li>
<strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the hash method to use (one that hashlib supports). Can optionally be in the format <code>pbkdf2:method:iterations</code> to enable PBKDF2.</li> <li>
<strong>salt_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a>) – the length of the salt in letters.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.security.check_password_hash">
<code>werkzeug.security.check_password_hash(pwhash, password)</code> </dt> <dd>
<p>Check a password against a given salted and hashed password value. In order to support unsalted legacy passwords this method supports plain text passwords, md5 and sha1 hashes (both salted and unsalted).</p> <p>Returns <code>True</code> if the password matched, <code>False</code> otherwise.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>pwhash</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – a hashed string like returned by <a class="reference internal" href="#werkzeug.security.generate_password_hash" title="werkzeug.security.generate_password_hash"><code>generate_password_hash()</code></a>.</li> <li>
<strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – the plaintext password to compare against the hash.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.security.safe_str_cmp">
<code>werkzeug.security.safe_str_cmp(a, b)</code> </dt> <dd>
<p>This function compares strings in somewhat constant time. This requires that the length of at least one string is known in advance.</p> <p>Returns <code>True</code> if the two strings are equal, or <code>False</code> if they are not.</p> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <a class="reference external" href="https://docs.python.org/3/library/hmac.html#hmac.compare_digest" title="(in Python v3.9)"><code>hmac.compare_digest()</code></a> instead.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>a</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – </li> <li>
<strong>b</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.security.safe_join">
<code>werkzeug.security.safe_join(directory, *pathnames)</code> </dt> <dd>
<p>Safely join zero or more untrusted path components to a base directory to avoid escaping the base directory.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>directory</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The trusted base directory.</li> <li>
<strong>pathnames</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>) – The untrusted path components relative to the base directory.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A safe path, otherwise <code>None</code>.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>Optional[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.security.pbkdf2_hex">
<code>werkzeug.security.pbkdf2_hex(data, salt, iterations=260000, keylen=None, hashfunc=None)</code> </dt> <dd>
<p>Like <a class="reference internal" href="#werkzeug.security.pbkdf2_bin" title="werkzeug.security.pbkdf2_bin"><code>pbkdf2_bin()</code></a>, but returns a hex-encoded string.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>data</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>]</em>) – the data to derive.</li> <li>
<strong>salt</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>]</em>) – the salt for the derivation.</li> <li>
<strong>iterations</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a>) – the number of iterations.</li> <li>
<strong>keylen</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – the length of the resulting key. If not provided, the digest size will be used.</li> <li>
<strong>hashfunc</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><em>Callable</em><em>]</em><em>]</em>) – the hash function to use. This can either be the string name of a known hash function, or a function from the hashlib module. Defaults to sha256.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></p> </dd> </dl> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <a class="reference external" href="https://docs.python.org/3/library/hashlib.html#hashlib.pbkdf2_hmac" title="(in Python v3.9)"><code>hashlib.pbkdf2_hmac()</code></a> instead.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.9.</span></p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.security.pbkdf2_bin">
<code>werkzeug.security.pbkdf2_bin(data, salt, iterations=260000, keylen=None, hashfunc=None)</code> </dt> <dd>
<p>Returns a binary digest for the PBKDF2 hash algorithm of <code>data</code> with the given <code>salt</code>. It iterates <code>iterations</code> times and produces a key of <code>keylen</code> bytes. By default, SHA-256 is used as hash function; a different hashlib <code>hashfunc</code> can be provided.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>data</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>]</em>) – the data to derive.</li> <li>
<strong>salt</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a><em>]</em>) – the salt for the derivation.</li> <li>
<strong>iterations</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a>) – the number of iterations.</li> <li>
<strong>keylen</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a><em>]</em>) – the length of the resulting key. If not provided the digest size will be used.</li> <li>
<strong>hashfunc</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><em>, </em><em>Callable</em><em>]</em><em>]</em>) – the hash function to use. This can either be the string name of a known hash function or a function from the hashlib module. Defaults to sha256.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)">bytes</a></p> </dd> </dl> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>Will be removed in Werkzeug 2.1. Use <a class="reference external" href="https://docs.python.org/3/library/hashlib.html#hashlib.pbkdf2_hmac" title="(in Python v3.9)"><code>hashlib.pbkdf2_hmac()</code></a> instead.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.9.</span></p> </div> </details>
</dd>
</dl> </section> <section id="logging"> <h2>Logging</h2> <p>Werkzeug uses standard Python <a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(in Python v3.9)"><code>logging</code></a>. The logger is named <code>"werkzeug"</code>.</p> <pre data-language="python">import logging
logger = logging.getLogger("werkzeug")
</pre> <p>If the logger level is not set, it will be set to <code>INFO</code> on first use. If there is no handler for that level, a <a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.StreamHandler" title="(in Python v3.9)"><code>StreamHandler</code></a> is added.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2021 Pallets<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://werkzeug.palletsprojects.com/en/2.0.x/utils/" class="_attribution-link">https://werkzeug.palletsprojects.com/en/2.0.x/utils/</a>
  </p>
</div>

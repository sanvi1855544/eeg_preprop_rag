<h1 id="sphx-glr-auto-examples-ensemble-plot-gradient-boosting-oob-py">Gradient Boosting Out-of-Bag estimates</h1> <p>Out-of-bag (OOB) estimates can be a useful heuristic to estimate the “optimal” number of boosting iterations. OOB estimates are almost identical to cross-validation estimates but they can be computed on-the-fly without the need for repeated model fitting. OOB estimates are only available for Stochastic Gradient Boosting (i.e. <code>subsample &lt; 1.0</code>), the estimates are derived from the improvement in loss based on the examples not included in the bootstrap sample (the so-called out-of-bag examples). The OOB estimator is a pessimistic estimator of the true test loss, but remains a fairly good approximation for a small number of trees.</p> <p>The figure shows the cumulative sum of the negative OOB improvements as a function of the boosting iteration. As you can see, it tracks the test loss for the first hundred iterations but then diverges in a pessimistic way. The figure also shows the performance of 3-fold cross validation which usually gives a better estimate of the test loss but is computationally more demanding.</p> <img alt="plot gradient boosting oob" class="sphx-glr-single-img" src="data:image/png;base64,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"> <p class="sphx-glr-script-out">Out:</p> <pre data-language="none">Accuracy: 0.6840
</pre>  <pre data-language="python">print(__doc__)

# Author: Peter Prettenhofer &lt;peter.prettenhofer@gmail.com&gt;
#
# License: BSD 3 clause

import numpy as np
import matplotlib.pyplot as plt

from sklearn import ensemble
from sklearn.model_selection import KFold
from sklearn.model_selection import train_test_split

from scipy.special import expit

# Generate data (adapted from G. Ridgeway's gbm example)
n_samples = 1000
random_state = np.random.RandomState(13)
x1 = random_state.uniform(size=n_samples)
x2 = random_state.uniform(size=n_samples)
x3 = random_state.randint(0, 4, size=n_samples)

p = expit(np.sin(3 * x1) - 4 * x2 + x3)
y = random_state.binomial(1, p, size=n_samples)

X = np.c_[x1, x2, x3]

X = X.astype(np.float32)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.5,
                                                    random_state=9)

# Fit classifier with out-of-bag estimates
params = {'n_estimators': 1200, 'max_depth': 3, 'subsample': 0.5,
          'learning_rate': 0.01, 'min_samples_leaf': 1, 'random_state': 3}
clf = ensemble.GradientBoostingClassifier(**params)

clf.fit(X_train, y_train)
acc = clf.score(X_test, y_test)
print("Accuracy: {:.4f}".format(acc))

n_estimators = params['n_estimators']
x = np.arange(n_estimators) + 1


def heldout_score(clf, X_test, y_test):
    """compute deviance scores on ``X_test`` and ``y_test``. """
    score = np.zeros((n_estimators,), dtype=np.float64)
    for i, y_pred in enumerate(clf.staged_decision_function(X_test)):
        score[i] = clf.loss_(y_test, y_pred)
    return score


def cv_estimate(n_splits=None):
    cv = KFold(n_splits=n_splits)
    cv_clf = ensemble.GradientBoostingClassifier(**params)
    val_scores = np.zeros((n_estimators,), dtype=np.float64)
    for train, test in cv.split(X_train, y_train):
        cv_clf.fit(X_train[train], y_train[train])
        val_scores += heldout_score(cv_clf, X_train[test], y_train[test])
    val_scores /= n_splits
    return val_scores


# Estimate best n_estimator using cross-validation
cv_score = cv_estimate(3)

# Compute best n_estimator for test data
test_score = heldout_score(clf, X_test, y_test)

# negative cumulative sum of oob improvements
cumsum = -np.cumsum(clf.oob_improvement_)

# min loss according to OOB
oob_best_iter = x[np.argmin(cumsum)]

# min loss according to test (normalize such that first loss is 0)
test_score -= test_score[0]
test_best_iter = x[np.argmin(test_score)]

# min loss according to cv (normalize such that first loss is 0)
cv_score -= cv_score[0]
cv_best_iter = x[np.argmin(cv_score)]

# color brew for the three curves
oob_color = list(map(lambda x: x / 256.0, (190, 174, 212)))
test_color = list(map(lambda x: x / 256.0, (127, 201, 127)))
cv_color = list(map(lambda x: x / 256.0, (253, 192, 134)))

# plot curves and vertical lines for best iterations
plt.plot(x, cumsum, label='OOB loss', color=oob_color)
plt.plot(x, test_score, label='Test loss', color=test_color)
plt.plot(x, cv_score, label='CV loss', color=cv_color)
plt.axvline(x=oob_best_iter, color=oob_color)
plt.axvline(x=test_best_iter, color=test_color)
plt.axvline(x=cv_best_iter, color=cv_color)

# add three vertical lines to xticks
xticks = plt.xticks()
xticks_pos = np.array(xticks[0].tolist() +
                      [oob_best_iter, cv_best_iter, test_best_iter])
xticks_label = np.array(list(map(lambda t: int(t), xticks[0])) +
                        ['OOB', 'CV', 'Test'])
ind = np.argsort(xticks_pos)
xticks_pos = xticks_pos[ind]
xticks_label = xticks_label[ind]
plt.xticks(xticks_pos, xticks_label)

plt.legend(loc='upper right')
plt.ylabel('normalized loss')
plt.xlabel('number of iterations')

plt.show()
</pre> <p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes 4.926 seconds)</p> <div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-ensemble-plot-gradient-boosting-oob-py"> <div class="binder-badge docutils container"> <a class="reference external image-reference" href="https://mybinder.org/v2/gh/scikit-learn/scikit-learn/0.24.X?urlpath=lab/tree/notebooks/auto_examples/ensemble/plot_gradient_boosting_oob.ipynb"><img alt="Launch binder" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG0AAAAUCAMAAACwC0NtAAABWVBMVEW7u7vo6OjCwsLMzMzz8/P4+Pju7u68vLzd3d24uLjx8fHm5ubT09PAwMDJycnPz8+urq7Ly8va2tq5ubnq6uqSkpLBwcH09PS6urrypVmvr6/i4uLDw8O0tLSjo6PX19e9u7pYm8qxsbGrq6u+vr7s7OzZ2dng4OCVlZXk5OTIyMiWlpampqaoqKj6+vrGxsagoKC9vb2ZmZn29vb///+Nq8Kzs7PSspNlnshfnsr2o1HnZYHXc46dnZ2Li4vS0tKPj4+3t7fOtJm2urztpmKGqsTarYFcmsnTjZzkaYXOl6Kqtr7lqnHEqrD1olLMmqW+t7jWsIzGt6hrnsbQk6Gis7/IoavgbIfhcoprlcHYaom+oH2Elq50kLzV1dWHh4fDuK2Xr8GZsMDHtqatsLrglH/sfm60pLHKqqDWnJHJcJDtgWzoknG8dJaLqr/0lVqeo7jlbX7owswW4TTQAAACXklEQVRIx+3V52/iMBgH4DcsBwfCCCkhQICMS4G0AQKUXqFpumh7Pa57l9t7//9fzlRHWeXbCemkvpEs+ZWtR/rZVqAKj/WvK7u+v7m/np2RdpjokG9pNthRIrF0dJjYfDWLGM/ed76dAWx31v923NS0tWXvRCtD90bTN9Sy1Ona3u6Hp1939+Cw04/SRU9bizwTLTbUG9OtoRZGU7Hn5xefEz9/Nz9tJt4ONDOGky7Q52AuCbStYRvKOmZcyENjKjWqPYnFdZSiQbd9vhCkyMyDUBQzBbC7WmhMe7Gyk92+vrm9ud7ODjRKLQZoiKmgakBTRcULdKboZlDVXMtERzWvMU915xhgknwag2auRaook2/JlhqKi+EJ7QR+5NqX7XYNBtq8wtIZYFQoUxAtc2ELsORIYbS4AGpgLEnZqetqHpKOIGLVKwnSIqIKrKkVIm6FG09y9+Jj4/Z789fy8rOBlsddd7enBYlGDt0Cyw+CiDwcmGOaDRC808ix+lRysIKFtG4g4IKIe/JK7qycf7kicW7l3txrQS9fYomWAptoqZ6mu8HEvVsyrmkIomxPCxLNwQVgSZKpkkT7I6HJa3Jw0rxq7h3AVu71veaPMfkkNlmc1PuaEs/HOYSJZo9qOo5pRl8D0aI0DRkeBnedhzSAd5fHpxunjfskw0Xg5YV5w9+qiBUeigrASxD5esXgVgGM1shmg68srDkyT7aAfxUUXuFXuTovSxWQSg++gq3c8nE7VxvqcOE6iA6kRRD6LSecfvgNObIwPBOFu/3y1De3UWvkGrWNx9/T/1B/AFudUABdgF9sAAAAAElFTkSuQmCC" style="width: 150px;"></a> </div> <div class="sphx-glr-download sphx-glr-download-python docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/0.24/_downloads/a0f093cdc82e6c383a734fc9beaf8e24/plot_gradient_boosting_oob.py"><code>Download Python source code: plot_gradient_boosting_oob.py</code></a></p> </div> <div class="sphx-glr-download sphx-glr-download-jupyter docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/0.24/_downloads/d45483409febd18772e1fe41233d258e/plot_gradient_boosting_oob.ipynb"><code>Download Jupyter notebook: plot_gradient_boosting_oob.ipynb</code></a></p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2020 The scikit-learn developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://scikit-learn.org/0.24/auto_examples/ensemble/plot_gradient_boosting_oob.html" class="_attribution-link">https://scikit-learn.org/0.24/auto_examples/ensemble/plot_gradient_boosting_oob.html</a>
  </p>
</div>

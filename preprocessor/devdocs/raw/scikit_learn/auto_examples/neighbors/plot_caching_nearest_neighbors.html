<h1 id="sphx-glr-auto-examples-neighbors-plot-caching-nearest-neighbors-py">Caching nearest neighbors</h1> <p>This examples demonstrates how to precompute the k nearest neighbors before using them in KNeighborsClassifier. KNeighborsClassifier can compute the nearest neighbors internally, but precomputing them can have several benefits, such as finer parameter control, caching for multiple use, or custom implementations.</p> <p>Here we use the caching property of pipelines to cache the nearest neighbors graph between multiple fits of KNeighborsClassifier. The first call is slow since it computes the neighbors graph, while subsequent call are faster as they do not need to recompute the graph. Here the durations are small since the dataset is small, but the gain can be more substantial when the dataset grows larger, or when the grid of parameter to search is large.</p> <img alt="Classification accuracy, Fit time (with caching)" class="sphx-glr-single-img" src="data:image/png;base64,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"> <pre data-language="python"># Author: Tom Dupre la Tour
#
# License: BSD 3 clause
from tempfile import TemporaryDirectory
import matplotlib.pyplot as plt

from sklearn.neighbors import KNeighborsTransformer, KNeighborsClassifier
from sklearn.model_selection import GridSearchCV
from sklearn.datasets import load_digits
from sklearn.pipeline import Pipeline

print(__doc__)

X, y = load_digits(return_X_y=True)
n_neighbors_list = [1, 2, 3, 4, 5, 6, 7, 8, 9]

# The transformer computes the nearest neighbors graph using the maximum number
# of neighbors necessary in the grid search. The classifier model filters the
# nearest neighbors graph as required by its own n_neighbors parameter.
graph_model = KNeighborsTransformer(n_neighbors=max(n_neighbors_list),
                                    mode='distance')
classifier_model = KNeighborsClassifier(metric='precomputed')

# Note that we give `memory` a directory to cache the graph computation
# that will be used several times when tuning the hyperparameters of the
# classifier.
with TemporaryDirectory(prefix="sklearn_graph_cache_") as tmpdir:
    full_model = Pipeline(
        steps=[('graph', graph_model), ('classifier', classifier_model)],
        memory=tmpdir)

    param_grid = {'classifier__n_neighbors': n_neighbors_list}
    grid_model = GridSearchCV(full_model, param_grid)
    grid_model.fit(X, y)

# Plot the results of the grid search.
fig, axes = plt.subplots(1, 2, figsize=(8, 4))
axes[0].errorbar(x=n_neighbors_list,
                 y=grid_model.cv_results_['mean_test_score'],
                 yerr=grid_model.cv_results_['std_test_score'])
axes[0].set(xlabel='n_neighbors', title='Classification accuracy')
axes[1].errorbar(x=n_neighbors_list, y=grid_model.cv_results_['mean_fit_time'],
                 yerr=grid_model.cv_results_['std_fit_time'], color='r')
axes[1].set(xlabel='n_neighbors', title='Fit time (with caching)')
fig.tight_layout()
plt.show()
</pre> <p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes 2.366 seconds)</p> <div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-neighbors-plot-caching-nearest-neighbors-py"> <div class="binder-badge docutils container"> <a class="reference external image-reference" href="https://mybinder.org/v2/gh/scikit-learn/scikit-learn/0.24.X?urlpath=lab/tree/notebooks/auto_examples/neighbors/plot_caching_nearest_neighbors.ipynb"><img alt="Launch binder" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG0AAAAUCAMAAACwC0NtAAABWVBMVEW7u7vo6OjCwsLMzMzz8/P4+Pju7u68vLzd3d24uLjx8fHm5ubT09PAwMDJycnPz8+urq7Ly8va2tq5ubnq6uqSkpLBwcH09PS6urrypVmvr6/i4uLDw8O0tLSjo6PX19e9u7pYm8qxsbGrq6u+vr7s7OzZ2dng4OCVlZXk5OTIyMiWlpampqaoqKj6+vrGxsagoKC9vb2ZmZn29vb///+Nq8Kzs7PSspNlnshfnsr2o1HnZYHXc46dnZ2Li4vS0tKPj4+3t7fOtJm2urztpmKGqsTarYFcmsnTjZzkaYXOl6Kqtr7lqnHEqrD1olLMmqW+t7jWsIzGt6hrnsbQk6Gis7/IoavgbIfhcoprlcHYaom+oH2Elq50kLzV1dWHh4fDuK2Xr8GZsMDHtqatsLrglH/sfm60pLHKqqDWnJHJcJDtgWzoknG8dJaLqr/0lVqeo7jlbX7owswW4TTQAAACXklEQVRIx+3V52/iMBgH4DcsBwfCCCkhQICMS4G0AQKUXqFpumh7Pa57l9t7//9fzlRHWeXbCemkvpEs+ZWtR/rZVqAKj/WvK7u+v7m/np2RdpjokG9pNthRIrF0dJjYfDWLGM/ed76dAWx31v923NS0tWXvRCtD90bTN9Sy1Ona3u6Hp1939+Cw04/SRU9bizwTLTbUG9OtoRZGU7Hn5xefEz9/Nz9tJt4ONDOGky7Q52AuCbStYRvKOmZcyENjKjWqPYnFdZSiQbd9vhCkyMyDUBQzBbC7WmhMe7Gyk92+vrm9ud7ODjRKLQZoiKmgakBTRcULdKboZlDVXMtERzWvMU915xhgknwag2auRaook2/JlhqKi+EJ7QR+5NqX7XYNBtq8wtIZYFQoUxAtc2ELsORIYbS4AGpgLEnZqetqHpKOIGLVKwnSIqIKrKkVIm6FG09y9+Jj4/Z789fy8rOBlsddd7enBYlGDt0Cyw+CiDwcmGOaDRC808ix+lRysIKFtG4g4IKIe/JK7qycf7kicW7l3txrQS9fYomWAptoqZ6mu8HEvVsyrmkIomxPCxLNwQVgSZKpkkT7I6HJa3Jw0rxq7h3AVu71veaPMfkkNlmc1PuaEs/HOYSJZo9qOo5pRl8D0aI0DRkeBnedhzSAd5fHpxunjfskw0Xg5YV5w9+qiBUeigrASxD5esXgVgGM1shmg68srDkyT7aAfxUUXuFXuTovSxWQSg++gq3c8nE7VxvqcOE6iA6kRRD6LSecfvgNObIwPBOFu/3y1De3UWvkGrWNx9/T/1B/AFudUABdgF9sAAAAAElFTkSuQmCC" style="width: 150px;"></a> </div> <div class="sphx-glr-download sphx-glr-download-python docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/0.24/_downloads/7880ee063d9d3845a0ed85afa9948265/plot_caching_nearest_neighbors.py"><code>Download Python source code: plot_caching_nearest_neighbors.py</code></a></p> </div> <div class="sphx-glr-download sphx-glr-download-jupyter docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/0.24/_downloads/2eaa49c025f80c826512eda4a8add5c3/plot_caching_nearest_neighbors.ipynb"><code>Download Jupyter notebook: plot_caching_nearest_neighbors.ipynb</code></a></p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2020 The scikit-learn developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://scikit-learn.org/0.24/auto_examples/neighbors/plot_caching_nearest_neighbors.html" class="_attribution-link">https://scikit-learn.org/0.24/auto_examples/neighbors/plot_caching_nearest_neighbors.html</a>
  </p>
</div>

<h1 id="sphx-glr-auto-examples-neighbors-plot-nca-illustration-py">Neighborhood Components Analysis Illustration</h1> <p>This example illustrates a learned distance metric that maximizes the nearest neighbors classification accuracy. It provides a visual representation of this metric compared to the original point space. Please refer to the <a class="reference internal" href="../../modules/neighbors#nca"><span class="std std-ref">User Guide</span></a> for more information.</p> <pre data-language="python"># License: BSD 3 clause

import numpy as np
import matplotlib.pyplot as plt
from sklearn.datasets import make_classification
from sklearn.neighbors import NeighborhoodComponentsAnalysis
from matplotlib import cm
from scipy.special import logsumexp

print(__doc__)
</pre>  <h2 id="original-points">Original points</h2> <p>First we create a data set of 9 samples from 3 classes, and plot the points in the original space. For this example, we focus on the classification of point no. 3. The thickness of a link between point no. 3 and another point is proportional to their distance.</p> <pre data-language="python">X, y = make_classification(n_samples=9, n_features=2, n_informative=2,
                           n_redundant=0, n_classes=3, n_clusters_per_class=1,
                           class_sep=1.0, random_state=0)

plt.figure(1)
ax = plt.gca()
for i in range(X.shape[0]):
    ax.text(X[i, 0], X[i, 1], str(i), va='center', ha='center')
    ax.scatter(X[i, 0], X[i, 1], s=300, c=cm.Set1(y[[i]]), alpha=0.4)

ax.set_title("Original points")
ax.axes.get_xaxis().set_visible(False)
ax.axes.get_yaxis().set_visible(False)
ax.axis('equal')  # so that boundaries are displayed correctly as circles


def link_thickness_i(X, i):
    diff_embedded = X[i] - X
    dist_embedded = np.einsum('ij,ij-&gt;i', diff_embedded,
                              diff_embedded)
    dist_embedded[i] = np.inf

    # compute exponentiated distances (use the log-sum-exp trick to
    # avoid numerical instabilities
    exp_dist_embedded = np.exp(-dist_embedded -
                               logsumexp(-dist_embedded))
    return exp_dist_embedded


def relate_point(X, i, ax):
    pt_i = X[i]
    for j, pt_j in enumerate(X):
        thickness = link_thickness_i(X, i)
        if i != j:
            line = ([pt_i[0], pt_j[0]], [pt_i[1], pt_j[1]])
            ax.plot(*line, c=cm.Set1(y[j]),
                    linewidth=5*thickness[j])


i = 3
relate_point(X, i, ax)
plt.show()
</pre> <img alt="Original points" class="sphx-glr-single-img" src="data:image/png;base64,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">   <h2 id="learning-an-embedding">Learning an embedding</h2> <p>We use <a class="reference internal" href="../../modules/generated/sklearn.neighbors.neighborhoodcomponentsanalysis#sklearn.neighbors.NeighborhoodComponentsAnalysis" title="sklearn.neighbors.NeighborhoodComponentsAnalysis"><code>NeighborhoodComponentsAnalysis</code></a> to learn an embedding and plot the points after the transformation. We then take the embedding and find the nearest neighbors.</p> <pre data-language="python">nca = NeighborhoodComponentsAnalysis(max_iter=30, random_state=0)
nca = nca.fit(X, y)

plt.figure(2)
ax2 = plt.gca()
X_embedded = nca.transform(X)
relate_point(X_embedded, i, ax2)

for i in range(len(X)):
    ax2.text(X_embedded[i, 0], X_embedded[i, 1], str(i),
             va='center', ha='center')
    ax2.scatter(X_embedded[i, 0], X_embedded[i, 1], s=300, c=cm.Set1(y[[i]]),
                alpha=0.4)

ax2.set_title("NCA embedding")
ax2.axes.get_xaxis().set_visible(False)
ax2.axes.get_yaxis().set_visible(False)
ax2.axis('equal')
plt.show()
</pre> <img alt="NCA embedding" class="sphx-glr-single-img" src="data:image/png;base64,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"> <p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes 0.337 seconds)</p> <div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-neighbors-plot-nca-illustration-py"> <div class="binder-badge docutils container"> <a class="reference external image-reference" href="https://mybinder.org/v2/gh/scikit-learn/scikit-learn/0.24.X?urlpath=lab/tree/notebooks/auto_examples/neighbors/plot_nca_illustration.ipynb"><img alt="Launch binder" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG0AAAAUCAMAAACwC0NtAAABWVBMVEW7u7vo6OjCwsLMzMzz8/P4+Pju7u68vLzd3d24uLjx8fHm5ubT09PAwMDJycnPz8+urq7Ly8va2tq5ubnq6uqSkpLBwcH09PS6urrypVmvr6/i4uLDw8O0tLSjo6PX19e9u7pYm8qxsbGrq6u+vr7s7OzZ2dng4OCVlZXk5OTIyMiWlpampqaoqKj6+vrGxsagoKC9vb2ZmZn29vb///+Nq8Kzs7PSspNlnshfnsr2o1HnZYHXc46dnZ2Li4vS0tKPj4+3t7fOtJm2urztpmKGqsTarYFcmsnTjZzkaYXOl6Kqtr7lqnHEqrD1olLMmqW+t7jWsIzGt6hrnsbQk6Gis7/IoavgbIfhcoprlcHYaom+oH2Elq50kLzV1dWHh4fDuK2Xr8GZsMDHtqatsLrglH/sfm60pLHKqqDWnJHJcJDtgWzoknG8dJaLqr/0lVqeo7jlbX7owswW4TTQAAACXklEQVRIx+3V52/iMBgH4DcsBwfCCCkhQICMS4G0AQKUXqFpumh7Pa57l9t7//9fzlRHWeXbCemkvpEs+ZWtR/rZVqAKj/WvK7u+v7m/np2RdpjokG9pNthRIrF0dJjYfDWLGM/ed76dAWx31v923NS0tWXvRCtD90bTN9Sy1Ona3u6Hp1939+Cw04/SRU9bizwTLTbUG9OtoRZGU7Hn5xefEz9/Nz9tJt4ONDOGky7Q52AuCbStYRvKOmZcyENjKjWqPYnFdZSiQbd9vhCkyMyDUBQzBbC7WmhMe7Gyk92+vrm9ud7ODjRKLQZoiKmgakBTRcULdKboZlDVXMtERzWvMU915xhgknwag2auRaook2/JlhqKi+EJ7QR+5NqX7XYNBtq8wtIZYFQoUxAtc2ELsORIYbS4AGpgLEnZqetqHpKOIGLVKwnSIqIKrKkVIm6FG09y9+Jj4/Z789fy8rOBlsddd7enBYlGDt0Cyw+CiDwcmGOaDRC808ix+lRysIKFtG4g4IKIe/JK7qycf7kicW7l3txrQS9fYomWAptoqZ6mu8HEvVsyrmkIomxPCxLNwQVgSZKpkkT7I6HJa3Jw0rxq7h3AVu71veaPMfkkNlmc1PuaEs/HOYSJZo9qOo5pRl8D0aI0DRkeBnedhzSAd5fHpxunjfskw0Xg5YV5w9+qiBUeigrASxD5esXgVgGM1shmg68srDkyT7aAfxUUXuFXuTovSxWQSg++gq3c8nE7VxvqcOE6iA6kRRD6LSecfvgNObIwPBOFu/3y1De3UWvkGrWNx9/T/1B/AFudUABdgF9sAAAAAElFTkSuQmCC" style="width: 150px;"></a> </div> <div class="sphx-glr-download sphx-glr-download-python docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/0.24/_downloads/3c0067f1f85f236ccc8a25c1245347e8/plot_nca_illustration.py"><code>Download Python source code: plot_nca_illustration.py</code></a></p> </div> <div class="sphx-glr-download sphx-glr-download-jupyter docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/0.24/_downloads/19e9c0cb24a132133cef3b311caaf199/plot_nca_illustration.ipynb"><code>Download Jupyter notebook: plot_nca_illustration.ipynb</code></a></p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2020 The scikit-learn developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://scikit-learn.org/0.24/auto_examples/neighbors/plot_nca_illustration.html" class="_attribution-link">https://scikit-learn.org/0.24/auto_examples/neighbors/plot_nca_illustration.html</a>
  </p>
</div>

# Werkzeug Tutorial

Welcome to the Werkzeug tutorial in which we will create a TinyURL clone that
stores URLs in a redis instance. The libraries we will use for this
applications are Jinja 2 for the templates, redis for the database layer and,
of course, Werkzeug for the WSGI layer.

You can use `pip` to install the required libraries:

    
    pip install Jinja2 redis Werkzeug
    
Also make sure to have a redis server running on your local machine. If you
are on OS X, you can use `brew` to install it:

    
    brew install redis
    
If you are on Ubuntu or Debian, you can use apt-get:

    
    sudo apt-get install redis-server
    
Redis was developed for UNIX systems and was never really designed to work on
Windows. For development purposes, the unofficial ports however work well
enough. You can get them from github.

## Introducing Shortly

In this tutorial, we will together create a simple URL shortener service with
Werkzeug. Please keep in mind that Werkzeug is not a framework, it’s a library
with utilities to create your own framework or application and as such is very
flexible. The approach we use here is just one of many you can use.

As data store, we will use redis here instead of a relational database to keep
this simple and because that’s the kind of job that redis excels at.

The final result will look something like this:

![a screenshot of
shortly](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArQAAAIPCAMAAAC17b1eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADAFBMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACHh4fSv8DCwsKEhITW1taknIhFTjLR0dHS0tLo7/D////n7u/Nzc2/v7+pqanGxsYRVXzk7O3h6uvc5ujHx8etra3Q0NDPz8/Jycm4uLjKysq2trawr6/FxcXIyMjW4uS9vb2rq6vz8/O0tLPr6+rk5OTU1NSsrKyqqqrBwcG8vLzMzMxISEjh4eGkpKTAwMDm5+b4+Pjx8PCVlZW5ubnCwsL+/v329vagoKDP3d+EhITDw8OIiIn7/PyMjIxiYmLp6embm5uZmZlRUVHe3t6ysrKoqKgAAACdnZ3S0dHV1dXY2Nju7u7b29vt7Oz///T6+vpMTEzz////99pGRkaT0/Pz2baRkpF/gIDN8P51dXZcVXz//OdYWFirioaJlbeaiIi7lof34cC+4fZLAAHZ9v/m/f+pv8iIiJeXvd0ObrrCooDgwKDAj1MtLS2v2PPatpCSRwAiICOIsdJrbGv97c3IwKc5NjiIosZSo9qHiac1AAB8NwClyuZmZmaecXzCsKHMyMCescPPqoh3pby81+QBAE/szZ9dXV0/kcwRVo6DgoPd0rV7enzI0NcAAT04Tn3t5di0y9Y+QEPv07A3eKbj2sKsfUDPNjYOX6R/irYDkjqJx+oAACl/gI57kqa5pJfn9Pq7iID+4IwAKY3XmE3V6PM+g7YEgDzg6OmQgHuVy3TzRkUEAHCjPDXUoZUHT5nvAgH3x3oANGV3ueKx2YZ4PzBeiq6kHwxglr/y6cKBX3kAQYf6a2pceZVXLQCgd17ot3K7UkOJZENqhJtFbDdzrl9rAADtsxHI5Zf5sbDAaWijZhU8b5Rfi07/kpGSr3XtrFlLZ4N2m2PRdUGatJRxhXdkP8BWAAAAMnRSTlMACAULBwIVAQQDEA4SDDQgGyYrGC8iOzI4HShHP01SWF1kRFVbiBmBdfT2nFXg1JvLy3vKajkAACAASURBVHja7JpdTBvZFYC3bZrdJuyGn5BsYNmHPOQlidQ+GDkPAyYuM0JCpZ16Cw+NpVYjVaoi7S22eN6nkkWy5FaWq5BU3kgeKR7HciUU2Qla16SSC0pBkUIwq6AYRUsCmADaECgsIT333pnx+IdgIEiudb+R7Lln7pw7jD6Ozxjee4/BYDAYDAaDwWAwGAwGg8FgAO8zGPuGmcpg/jJdGf/H6uYk/jGD8Q45AG+3t/UnDMY+2N7dd2UsU5Vx8Pq+A29zjTWu8wGDsW8KmLs/bbONLWDrDxmMfVDA3Wxv9+ys0VgmK+Pg5DV6uzdr85TN9/UQg7Ev8s3dl7YGZ3Vl82z9AYOxD/LczdJ219bmK2v0ld1uxjuXN+NtjrZ7c1ZXNkvYHzEY+yZL3Cxtd2ut7qxR2Yyw6nofMhj7JFtdzduMtsVbW8hZTdkcXY8yGHskR12jtru3NsdZg7IZYfWVjzAYeyJHXs1bXdtdWWtsZ/UyqyqbEda4fAWDsSd0eTVvqbaZYqs3tkVKqzurKXuksq66uvo45aTORwzG3iD+qEIdr66uqjxi0Fa3tghps5zVyyz8ElTUnjt7/hcMxgFx/uy5qgpabQ0tQlHWFqyzuDGoPPdTR7eFwTggOhw/O1eJm4SCtbaIQpvlLOllj9ad7TYxGAdI99m6ox9SbbOs3anU5jQHGWePHj9vMln0jWDJ2YoPso1t+Zvp/PGjOdYWVWoLO4u/LTip+meyCWLrtyng21ZRsBmCc0lgLif4ZhF4YwgyGNtgs5ysOIK1LWRtEYU2z9mKj2wqXNuXqdTC3M2FVOrLNk4P9iaT6ZWVdDLZawh+sbi4trm5trj4Bz1Y1ih/cu/53JHsU0eC200MdJbt/fuoooC1O5Xa7Z09rEsrgrPpybt3J9NgragFe5Pp11fv3r36Op3s1YPg7ObWb5xbYO0XYgneo0AKocRnwWKmXv3sXzabyffnbaRU5iDTtM3nD71N6dQ0vN6641YWLl++/GLQZvPeGVSPmZRl46kwvLdNFsurCaFspT28vbVvL7R6c2B09vDHVpXWVHJo6NnLl8+GhpKpVi0Izo7Nf/31/BhYqwehzi6NK771JbC2yVpyeFBiuOmhP1TomPIwmDM3CgHfNXfhVHH0vFOOWX2uAslaeq/QHZ8rhjNF3Yo89Xc/GmixxqN6PkXOOlWRYwWWGfk3B2uNCtYy5ePDWdZmGoS3lFpN2mxnKyrA2ZoTLRTuZmpo6NGjZ88ePRoaSt2kQetc8vXY2MbjxxtjY6+Tc+rUN4tLS0vr4+PwurT4pqXEsPrkxF8d3c4eS6GjUDOzJnsQGuBaQNqCuRR5xtHR003OMucdXL6nLuiKwRuR9oHzn/KU1ALSZlKEsjPGWjghJ5NA5sdHzS1lyokabG1FrrU7SUsLrdYckDpLnD1zQlBJJsFZylAyqQahzm5szD+en9/YgFqrBtegzlKWltbWhFLDgx5Y4A0E/eqNa0LyzaJESBD6ZhH6Hg+uhd34Q3+VVycj9FQAaQUa9ISDgm92WuAWYnDU3A9DwSr4XC9kNAW7Pmg8LrgFknkOJfzTOAdIizNhaWOCtX/CjSXUrgakpTu4Z4nBcHUBPgj0TMrC81RiHS7iDh8fbUytcrDyHbNQZpw4U5OptVqDoJXaIgut3hvUnKn8hKMIGWextWowPQbKEuY3xtI0aNadxdqucSUGeHid7vlc6EWTb3lGmksEud5haQ7dUPr8z5v4eDQY8E/TyeEmV9gN0nI06HNNc140JUFDgI/fQui5nWRaHXHFON9yOBiYnXDTzK6BJjddJwavVFpzn/8bAXK5tcuRZJKI41+F3YEgp/SjqU4ZMqiZFBld+FWjHL1yUYBKC9fABfxPBa7M+KQyx9qdS62xo9WaA81ZXVoOpH2mokvLQUMLwv4HWwulVg1iaZ8QSlFazoNuaNI+dTR70PTPR/whLuLgA/6QcNt1vRlsu9jumpHI5OigFw2AtGqQ758x90Of6w0P4sMRKM3RG5Bp2tksxyD19WbLLRQimW1yrNmWLW0/lMyBDs4oraJKa36VuBIxwXDm993eqFvLpMgDjm6bNzpo4eKjvA894OJ05TKTVrdWbxA+eHupNRRarTnQnT11mqdIK2nQ9b8AvKVX1KB3DJQlPH485qVBbnMJO/vdd1jbpU2+1PCgEN2BThSPgMQNvs+P/gYHcAzqJP48lsjkqNvSj/7icmtBb7jT9fnydP89heQw9Xj8UInhLLsc4z2JIM8HQFqcGQfoOq4YzSTJMZ9/APKCtNrViDK9GglqamKYl+QHZnxYy0TGdH581C70T7S7Ygpfbpw+dcpoLW0Q9FK7U3dACy1+CANna8DZY6clld40dvblS6xt+j6N8X1e1Vmw1tunBrc2ibPY2vHNLanEgIJ6QSR7oJYkQUnr6ekx+fyxntuuEImBZBBy8ngOqMbfdqGoWwv6/NcmrP1R0ElNF/FGg/gscBSSkYwhkhkHKPIAvMQnRIjYPGgV9kFgFZCW5uGcihx1k5OwtGommoTMj4+K8Cv2VcIt8VKZcfoYWFtDrIUGwVBqt+0PVGnzCy129lg93E+88Y0rK9hZbO3KShcNSqJ3XpN23ivSqZK4uU6cBWvXN0V1ZulsLXF4Zro0skDVUpbDVy79DrRbbV1AwyDt6q+5OHpx6Zd/JD8Nro/QBcPHuRrkZRTjvWiCiCY+HL4YkEmlJY76XFNBbSxJ8JRGbon5FXrRNTL7Da69UuQV6BhHw593dmL7+C4sLX5/2ClCW4un4MKqZSLS2j3oyiUsLVwtGuCkkrul+93qjxFr80vt26QtWGjPYGdr6/WSEFiZfEmYXAmIelCzdt6bCbZvjlNpxzfbxdL7vY7c98MnPdRHF/bltgyDED+H0PcyesrHUSJogQGa6VIrLZyAK50aBGGDoHZMwUe7cJMadis4kwh6maHFRVN0jAslekoWVFIwbWqQTJGU2bAbp0K0WGuV1o5ThRQyJR52a5nIGH+pMdGIpYXVQ1L5UV9bC9ae2a7U7iytWmhxcwDOVtXbVRq5wH1i7eT9ANeYCXrnoUP4BzhrCLavQ6198mR9vV0PlhIWBy9FnIrZqcDA7LTYnIrUYYnAE48NvytSpMPa4ZTgoBjBc8QOeNWCkR7FzvV00ExOCy/AMZxJcnbb7YLTZlPHdnukw2YjsziHIgnaFN7pVCI9GIXcLDlE5kiObqvDQqfgRdVMZAz5rM1wxZJd7J/g7eVHfRVYW4kbhEyp3Vla9Uta/D+0xkJbW1vVIKp0tQm2kb7Jyb4Rm9DWlQmaRjzAiCk7uLUObBmCJYXdbOZFu4itBCS8D58Iop0XyTsOSerPYjhJDxqQzGZ8skgzATxPJ8O4y85r08wwLf8q8DltqZCWirdnHeZ544Au7YHaLZYfDVVV2aUWRNS+qi0o7ftU2txCS5uDqqqGLo22Rrutw+nssNkb2/YQZBREcijFTxZbf8uX401oqMOllnyDkFdqCza1WneQ+cNChfYUBs7WNTTqtLW1Gd52HWQUpmsXc3mTvRxvQUNdHSm19FnM8AeG7fqDLGkzj2G4owVnqz9lVjEOmk+r66qqjuGuNvMoVqS0hw6p3YHW0RJp2xiM/7F3bj9tZHcAVqWstNuVUJfAQngJUfY/qBJTKTFbYhNwiA0iO47JwGKIO75k7GN7MlaRkMZCcndXQopoMILaiiOZoG7ABAU73LqglZZuHrayNhJPVEWRkPKwD33JvvShPefMxTO2xzaxqVqYb5y5nN+Znx3Px/GZM74cM1Dallyvlu8f4EGvCqQVurRiQ9sIna2/2N3d398/iOgYVNAx2NEhWzt5UUg/ZrAoKJJ73vu7xS281q88Klq0ZPRifX2LMIAgSfuLSqUVewdnz+Khg5aW+oaL8JB1GAyGHqNRX5zeXn0J/n+jRmMP/H/j/7sMb48X3tCaoUNwWqNaLjY08E0tP+ol9Q/KSJvr0kpjB6ihbWg4P4iOW4+JpByjIqvKtdzmiYo6KFJvNPTo7R6SgxOacRyeoy2SdFu9HUJ7DO0d7OdX+C3cPgsttBYtGz3f0FAv9Q/w+IHUqVWTVnYeJu8dfMRLixoar4+yhwZ+d7oYCNkpn7GPJI3duWs3Q3BCs6G73V7SY4QtsRz4941neFmAFlWL8tJKp2JCpzZ3JqYu7ZkCaevrG5qQtF49qRu+E7p5ugjdGfaRPpJD/aMiDPZ3k26voSgdhlJo0fzo+SZsbZ60ZyqRVhqlFccOoLR1n2BpHS6krCt3RF0nfkLa2kZ1lI5/ZvlWQf5cdwz2crjbyz/zHQXHoqPYuhYtjBo+qRP7B/z1hfwzsTLS5nVpm+pae+ApmC/MN7Muk45n0HzS21nsbShjDxtLtBKjem+PQaNqWuuasLSNsk5teWnfV0qLL4e1iNJ69daMC0P40dzMBAYNNtfJnhA2V8afQeMEEj1oQjOeVZO3x5A3FRQoAlq0WBRJ29DSgqT9lVLa98tLK15agF3axsYW1Duoa/Ua9X3WCbMNQXMhBG0YNg7yJScb84QnYzTyA109eQNfqCTc5/UqSjXeidY6sX+Q69SWklZ6B/gZQVrhPIwf8KprRtKa7KK01B0Ecffz+77LxaxlAsyVKkVhLLTN/PKLd0izbZXtpJZi48unR5GWnNAbvfzILBqhnZkR17ChGZ9RXEfL3JrorxatKNraXFTaM9L7wEtIK75bRtalbW416nt9/gn+u0RpahgRYq613bIT+d80apt+g94TnSr3jaTbk4dd5o35bJGQbfsnmCJGzP/QpbZ3FN7BxtzhlVn02a4luCreoe0ve7KdNlRSbCezR/jy1Dg3YTLKmJkxemWbE/ZevTzsVUTz0aI8WwnEuCwKpW2SzsSk98wcSdqzCmn1vSafP84byjoGEMN37t9s59j8I/wsCZaYr78sIm0U/F0hLciaibmi8kTBQfDlJgGlVMuBpIXxrllw8FVyLUVI0pq312WaqqXYnjyCtEScjOvlWiYSiqd/wmoqeWlNoxjX4+Pj4/HrshKZtOdywwdHl/YjQdoLJp3P6onTBIJ1/F5g4IaDJfLYAa9dZpvLHN3nQAw2mbuPie15ANZT6UkAXhMPk3AV1YPSgil6LkvwdaL7qY1/PO96lkBBKK3ZZaPnDl+B/SeoAvhXikAJl3AOVGM5RdBY2u9cOyjPckq4//R6F14uwgY/ppYCSjubPIAP9nkXUZ4FLt6HGlO9cA07kUBrRqHEGLf7TOiyr74Xw6/pZUu9Fi0SvZyJZG7Loxeam5v4ywuVS/uBJO2HMmnReVhz8wXorF2UlnHkLhg5mLwDzIr6RMHaXzfnljd3dp9sW0cegtf0W3DwYhEcpJPfYrkm48m9kbksy9dZBLFpsJaK7o2gWBLsP4ZSgv1XAFYAscXk4QhOiHIopf3+D8kfRhTSjuC/iX8upx69UEuRnsyiCs+SsQqcpReoBatPZ8LMzMyglzW4MInE/VadSePI3B69rdiG0vKdWknaDyVpP1CXVhzxwtJK18Pqmj++4PP57J4FlkYwo59LjDK0EiQtXonuPrHBxvXfP8HO6aNMBGTpKJiCKu+/gq7CeDo5FQU/z2WFOtuT30QBWJrLon1xy3jAzu11wSYxPXlIwJf/TZSQQDnQvUBp4V0djuA+bSp3rzDv+gj/OMD6Y1otBZSW3gGxnb0uujwsltbX12fqQ9ImEltbyFq4iUv64m6otE7Xp+uDN51sLVeiRYtF+5XRCx+L0uIzMfEjN8JA7TtIa7Va7eQC/iQeG5RLG2TzeAte4yXUik1PrvmtvhdQzpfJLBsFMfjvZ6vvKYqnkzEadhuyQh0oGVia3wVTeGfaNp08tEAp09g4FjXHKCHOgYDGscw8kva7v4FvWGYOBTFQWrzc+OoN+JZRSQHL2GnwJ7BEsxXgdDihtPzTjX4gIJFAc50IlBaGNarl6NK+pyYt6tJiaf2kk8HH0CKX1pJ3gOlpAL5v6341FV3ehFrtLlkewVf/Bw+hWVHcPVjf/NrA8NKy8KQtK9SB0bXUDtjDxr18eu3PycMgbxwzvxZ7NLk3ghLiHOheoPwvHsLX/VmA1F9i5na/MJoeyKTdto/kvC9IgaSFfyb8vZWDQdLKvNQlEoone8FTRFqrDxaquqxFi0SRtE2q0r5XTlrhgphCWrubk6T9tUSBtEwXHvLaxdKy2+iz/rHZJPjNm7VN2BH4IzoRA4fIlfRkjKWRd3wddjr5nFmEm3w7ir4hQGgmWXQet59icUKUA9Ug0JcGQD1n8Z5rD9D3BQD87S+CtOi0b3lKLQWWdlF4TSgr7cqoU6FlgbR2q0b1FEj7y6NJK7S0jZK0drvfw60EgwwksJqTdjXA5NNlYyysjb5iYxkGLuGNNtM2Ar4Q21iaIcwsYUPVYDnDEC5CqAMXNqYLbiKu0BYGFv1og6W4Ag2TCQlhDoSZsIzAAtqF92R/5K8sQ9J7L4T0rHoKVBZ8u5xiKiAYjIyu+O0yMWdmFE/2Aum2Q6xCDaXBsBiFtGj5qCRtY5XStgjS+t0ekopYgohL4Zy04UvBQvCRtojreI5vQXG9oH6ZIvkWU2IviCXtt+TXLJ7iIXhdNENhykg44vbbc1y7Zpfj5DxC1G/3iwtxkqFFS0btVUuLruKek0nrdpOkI2LB3BqNrwjER29ZShOQzUvXOXKNQNGCIFtZikCAZS2VcW8iQnrcfr/y+YczHiflcbv9EnnRPLSoalQm7TnxOm5V0pIkR01EAhY0XbpsFIfWjJcvWQIlJ4tsXrrO0WsUL1DLVpAyWPZuhSnijHAk1NaTjxtPzjAJVzWq5TikdTjJ9sD/Ou2B9vZaP8p2asvJcaRHjXicIkn1sEaF1FxajgqvrLSfVrYiGQfFqeFwxlc5/ClHjWqoubRj42Nh5rT+pHOACX82PnZPlbGtz0pENSqk5tKazQT76a3TyqcsYTbf1zheai7tLQ2NY6bm0l7T0DhmNGk1NGl/q6FxzNRc2oLfhOzspSYi9+5FJqjezusaGtVTc2nzflxviIxkTJbQ8HDIYspEyKGrGhrVUnNp2xRYVzjzgISZW7HKglfbrsJb2zuj7X9K96+5tJ183s62zs62u44Fy7ACywIlxDpzSxH5dn5Mjrb/Kd+/5tLKf6SMc4Zu5BEai4+pEKGGpG/IpBacGgtU3k8BdrvD8f/mA4iH3d15vzvHRVSO3moFdYrWHqLKV1facfc4pR0dC90pIOQkB4pjzlDinh6TK3QzdBPeQkroGycVQ2ERG/bIffkPd+f/1ER6BvD/6XaCzNwZwIS7xpCkGpMQkribiyGEZEPIdxc4d9lxqQpyCjR4YZmg1YxXimAxd8VcbwSv9HTO02bOyrWdqc70h5t22v5w9sdO3y/7bjaQAM6gM/ZNQvZ993nffXefT559dnWfp8UrB7sy2Tc3pWymKyh7W7RzEMR0Y+WlxdCeMg2lT4XK1mZiXGM6Dh7aWl49f8mdTmfT9dSls+6Sj2lcnBLpWs4yO/aA6WGYHpb6fy0tO5toZ1mTptAoBlLMaZp+c1Oi6dNMKiAe0UyCyzbRHZON7i1TKxZV+qTkbCrFNabj5IFDq6bVs0uGxlExDZK7yU+bI31FBkFKshec8qBp97xt0HYa1cXejsEU4o1OHjp1en/QUrRYy1LoE/wMTfV+uL41R5vvfY/KmwCX8cu+2iy45naZ24dMA+ldh2zS5eChJWn1QsGwprjDxx1KRMxwMIJMbs0Mk2UO5umEmQZFBKlnQIkU2nLSrPzcMm8Ts+6uWJgsM6ZUFwMXzEfcPmaf0FIiOh4weakpoO8B6FOPp6amvqXXvn+t1CZDshxKKpUefcBEcqh2cxqFhfv63PXK08r4ovl8XC1FY905N42k8b5x9QzU8ZDV1rluha2Dh5Ywa5cS2jBXyVIh7nbj5YTUJMYyRzpjaNMREinU2Gp+C6E9kkz6yLK503P4FFywZ9JHzXtDewxDq2bWHOR7kMEGzE7NUfR3GNrX4yvEJFRihFp+UJ0GV1MWyxUKHNtAeVhmxBEdKWhKM1VrhwSDmlpdLl9S4YNr0uXAoSXJn/yi1Wl1Oq3oxQbgvMESbhON2OQesoXrCqf0bYHQmpmsV40U2mkwgwbGjKDNffrtvg5+7uZ4w/Z5/yQ1c3lfJ0cP5iuXHtJW92loW8JuEzG15gGLx2sBjZ1m56FdoLVEZEmOWI5KGFpyNH1l5BjRyNLepqnvGltaOpf2nG42n2H75P7s7MqKPpvVr6yklAa27CPz4FRdtRWhSottO5SnyHB9slTI5wt5SQJ/CgXlfOtWIlCr0pohwVk1NmjyuYJiDJ+TuYZ0mEyvDdrVCOtkneDNsk4X3MF8AcUxglG++oM49pWXd7UTkmFRpyUyZgBp1luLFHoojS+oEUIPZ3c76Gc2IGFnz43mnn/VUGD5d6PUo6dDzUcYrgqCALZxdkwQINxnBGF1vFYlm9idd3d3Kp1OtbixNWS6kp5MZ0+PMW3VmZq7B4m+lVX/KnwStB5avxc7xPTc+tTUC5q+9/z5852WNncTzFtoNrczwsV9QStgGxuTSAAA2utXCSNhy+yAxDxk0r5DeVhGkuUoEkkmkaAa8AwrXAOtEgfN6Ux9oBcjLW1+ke/Hgd+4ukhprxdalFdPtsPgVpBTHziP5PPFfJ5EvGLtsgKtl+ddbQrJoDhIXj4REWrha5FCI9md0M4sUNSFzR2aWJxDKro2mbveBNrPAbTf7FRt7uVVBdrAkpV9QNHnfzZ5AcA7XL1MzWxeJFV1E82LztipNyXDHk84adLHuhLgvJ7odjJHEomEJWXPYNb4Ei6uGrSWkggtqr9U6sPQkuyFITuqv0c9AJZ2ifrvk/ug/PP6tvlPC0u9zNpnzX7Mm/uDtk/ywC+P1Eda7CGSL9GhAHS0QMLrFY7VK89kchBooaXNyxaLrEKLTBiSd6g5GLE464/5vOJRe0nvkrhgxICHZLXQOkg2R/uBQ0uy6kk6HHXF0AeQRWFx85kUemUyOgnjG4lEALYD7YhkALiDdCbQ1iKF8mEttHfPCxAgYXXpnBBY6J1ZuClcGqeGz0F34OwYcgquzFEI2pmJ+J9Bw/w/4vGruZ/H478ZxdD+bTp+a5asphd/EV8fehSPPx2FgwwHkXrnIaGLG70z1yYBuDdIVd1E8+I/nLGG0U3qbNiaaYVYeny6sPPYcTfb2q0YWouMmBXNNWj9JchsZ0mWSwq0ShGcqL7+MW2+/B6Nmb1//wlFDaIH9AfR2gvCDWX7d6rC74ELNT8mbN4F0/1auBRZGILQ5r4WNsdfGVqnQObhwIrjgUor6FXMF3jc5qiXkWRRyksxA7iOcRtiErJYLuTduuqkgTgybcnu40JUjIlCqBzkO5N4yAxeh81frctrg5azoagr7SNo/4rgk1dDsdg4/A2frITW9rDSXoPWg6GtRQrlLR6zx2NGblbuvLBwR5g9O33tw3dmVu+y1IywkRjbvHjWNQpVd2kSoTuLoF2O/2rt5a3R4X8/vXtnKTe2dGfiLxja+NOW6+s0WT1xde3u0IXrW58NwUGGq5u/fABNExjvysYQeIMfyhypkk3sUizvuz3kTo3H/X4WtoUHWIux3Zka8KgGDEGr07gHIg/+6PtkWZTroS1j0Ne3frtA0waFWQgt1S/Lcj8e4gtiSs8Il8PnwfGobrw7I8zS05tLX1Y3ILT04rV3FzcnX9E9oJiyShjSU7lQrOAyUqkUC+V65WGZFWBp8yWrlc1kWKu1hJSfgZc2wUydNBaHYVuCfflK1CsEeH7wuMID+PgR6P66LgcOLclfzCVw0BXWO4J3rlKEsWRsSZvN1sbhBRwRIIba4EoH6Qyh9ZjDfC1+HbC0sA1D+3AOfa4Aq4fcA0iScuIGlQVkJYFqALT0S+AGzE98tRz/CLtnw5/cxtA+vQhdBGX1/MRjAGkOrENn7lzy0yogFJ1PFzXQ4irZxG4la7AQaMMdWeV65pDB3tHhctfc3gBg1qv1aWXXtlte5ICUezC061tb79J/IMzeR14GIh3tOYKWYehpcGCGq7PQiaUfbkDvBh4iMP/h6lz6y9XxPS/EutLprtqFGNVTJvNwIEVlrNYRtVitmXrlYZkVUVzJF1dQeCzbSjGPZMAFeYBNwvWqtCKub21dKRai0ZB30OX3GY14SCCaQqCn6rocOLQkQWH0sBIMIGUT8N4V1fgAh6P44VUIrf6Era2tHb7b2x2ks4huG9RDi5pSxKfF0A5hsOACUBJVc3hp6O8CaHPPHwOAJ24v34L6BO5BIX5b9WkffcMoq6nFePzFEISW8ATUS51Zrbe0SnWvC0FUwjZ85WhOJxCzvWvPnv34w4C/+uOzZ2vk+skpl+S0Ftqydxu0JN+jYEX1X//nry9+QtPv/KtmaSlmgNE6rfSVDXhswPGYU47NcHW8Bq2ALzH3c8tL+ilpsApkHg7y3HGF/J+AynblKTIQ2mIlz8MYJny+UkQy7alACvdXpRXxbqOpEi+MhCL+Ad6rH+jHQ7ajLgXYqU3T5cChJbkKS51oMmDjidTxkgPunvqkdWdJh4q3/9gHbbraA2sOkuvwlaHtxQ4oMrEIz4c3MLQvtwDP0NLCtX/6fJz6RAvtkLIauBPT8Y800FK5scvU/CroNL3Qu3wJ+7RKVdnEHiURxneW3TZUXfv7PVB+qP4Rfq0RIX3pZN3dg6Miuw1aJVthyITqHz+g5r9Y9lC9iNonT+o3eQHd27iycfq8YmnBPIHVBVMHTrsC7Y39/eNCqRQq1ag1hUhiNIdOKZVolGNZLhqtaJSHM1NiGQTtSDGmMxh0MbCAZHQnUmjlCZ3DuGPIWMDrlYN8hI+pQ56A7anV1LYuBw+tMvcyD7ajPljtkuDu6eC0wQR4oaPD0GEw/I+9s/9pKsvjXEnlXwAAIABJREFU8P/kdTEVltVaGroUVJBBsXjbtSBKBQZHqJRK4UJ1lBXWl40mC8ngRtfVOCBuXRA0ZeP4QjKsTDaOmTWZTiZLMrMmmhB/0F/2vNzXci8t9paFzOfhpe3tua/n6bnnfs+5PTXBbYZ7f5TNckrsTuF9Me04xvaxSccM0l6dbxjpudZAzou3w7euDvbT+O0YvVISumipSOu0P7Ve6//jVwNdbybmp27/9OXApT//U9RJq7w99IxUIMKpCxGBLqR/kzBDLmpIhg928+iBeOXxoPJSXkUG3PtkaVmTgrCUTKZSyRcv/kP+J5fUxt2AMeTVkUjQS832FjmSK8keuAJyETzy9VvClFj6nFQO0qUVL/acj4SJnmM9t8NXenpJYRt5ePc8mTx0pofXaS8+HqidepZVEKFcUq31BfhWEMN2kHyjmRcNhcjz6lAoqs889gnjaRolqXG6czronZ4uCZInabd5VbMF0h91kQWe4G9r9m7fccClJtrO3jtGXZHtYIOO5klal+vIsH4bf7PzUCjKt41sx3CA99bZ4Xa7g26tD5H6WcpGWlISftNzOUyz4wo555GL4i5SWxMvskjqGK160jgtDRh8RSbN/L619c7Im9Z//7f10diXRFpSxJI/+e2uN62tDyKkkvD3XrqQbrK8mxGrOK28igzsPe6nV47+jkr2MpWc86f+tbSUTHXMJVOWcdr2xHB9oH5Y2qmTlpFg4YNa5uzbr0WRFbTP02N2T+nZ/4uIeIVXArq/YfvR//TuTV7SCv1nyDsDWUkr+OvjTbwWk9CKRSWrovF41O2m/5dlHk/TKCUap0PRRho3aoyGptVMJjlOfquXL9L1qdSU5oOuf5k7mPeSlhByGm6RaAsOK0+docrKygOVB8gvf1SIqtKy9tsKvbQVrA16p7FoqSUXTrUNtJ5Q1qC0C/QKRq/8/C2xrJa2bInCfmNEnr0timV+2t7k59VDsazDzxuYlBaxjoj2kq8iA7XusuPtbW1Hj+8PstUnkz/PJZNz9G9pBWmFjpKD0sHiDiFd2k/ZsZh6ywlHnjOWi9bBW8RO+PlO++kruuNzyrVjrT/rJr2GX/FAR+yIZpiSadXxeHUl+78s83ia4USiMRoPRUmRTP7ivFeXkuGVWmptkZU+X7oPFrPYLq08pGaz925C+dDwz9av2/hjMJg4WGDEU+AhvwUFUWU8Tllan3R9mCP5KtiknaZH95bWCDRCS0ghfKNXsBW96HwVmU6uB9p3kMLx6J6je9ml1hytyyb/OsUelrLuMKOOrOk6WEw1es+c/U4YspDW/PD0+O4+/vgDUnzQqQ6UGlWyjEaG+P9lmcfTlDBpFcZbWBolrZa6WVtkQdOudB8Mlmiz2C+tSmi3/EGpNBasu0OuOnOiyqxc2n3H3MoGu4/tY53CzaXtKNT1AV2DbqZZJCrbyy+pxPYCVrRVLKVSL24cFx/+nEotta1eWq8rRvs5ln33/v37sdrfrcZZof+zPfciH727rh6XthXROkuiyvCgPE3BNv33SW4rkFNVpWV184qLNLfDfmmbVXzxOv1nS6Eu7rMYEX13pzJroryD3bmQjoW0Gw0xS2kPJ7Sj6XX6AhVWM+ePioDP6dW2orPEajj7kmjmNE6T1M2du62Su6L6WTQ7mvMorUu6Xle1jLqo5DQfW7rluqTMGms277tY3vZLunOh/FCsWUdVTSwQPHxi7TbpxOFgIFZTpd8GabzYPPOKx4czpjFN3Sxdr7FKFtWdaGo0O+yXVjcUrHM46k0v8b3D18ej5nRKXmVO16eHwKFDAZdhaF1XXY0vtpbrj/lq6tI2Ydgi86olV8Y0pqlLvFJnNAt0dpTkU9oSpxQPGM8NgbjkLrDA49TmrPMUAP0BUbT1rOGB8XjSlKVZ6sm8rU7PqvbM6VntwbBdWsMA0q5YSNIV/jVSKObCsNogR/IrbXGzN9HZ2NO0paR4S1NPY2fC25y2fv2I0x8D5v8Fzm+7tLvS8Lpi0jiptXSOSzGXdxcAOWO7tMsHPi/xOuuqquqc3hIMAg/swHZpdwOQZ2yXdgsAecZ2aVsAyDO2S1sNQJ6xXdpNAOQZSAsgLQ4pgLQAQFoAaSEtgLQAQFoAaSEtgLQAQFoAaSEtgLQAQFoAaSEtgLQAQFoAaSEtgLQAQFoAIC2AtJAWQFoAIC2AtJAWQFoAIC2AtJAWQFoAIC2AtJAWQFoAIC2AtJAWQFoAIC0AkBZAWkgLIC0AkBZAWkgLIC0AkBZAWkgLIC0AkBZAWkgLIC0AkBZAWkgLIC0AkBZAWkgLIC0AkBaA/7+0mwEwZb1Ki5wBuXm79tKyDdsKgAnZWbvm0nJjC7cWApCO7O16k5Y5W7iwUATAMhYWCrOxdu2lJc5uahAAMKFhE7N2/UlbuABngZW1pKxdj9IuFCFvgBVFC+tQ2q2QFqws7db1J21hUSmyBlhRWlS43qTdDGlBZmk3Q1oAaSEtgLQAQFoAaSEtgLTIGgBpAaSFtADSQloAaQGkhbQA0kJaAGkBpIW0ANJCWgBpAaSFtADSQloAaQGAtADSQloAaQGAtADSQloAaVctbfgTyrMcD4NIF1IUgQ+Qdi2knXFQTubobNckXcoj+ABp10La7o+WNvx08fXrxVfseVefDeoDSJt3af9C5xyFtJAW0gJIC2kBpIW0kHatpT3sbrl69ckX9+eN0oa31ZCpt/VRqynP6SdPTg/Nq5ayAagEQfys5uo/5jeX/0jnvEPWF1Gl3U+TKPEzP0uPOBikzVHah5JDYfayTtqZSXmqWlr+rU9NeE0XHZs4N8JknXRoPFKk5Qu7IHLHWbqJXkgCaXOS9pJDzytV2nfaRG5t+Iw+4Z2I6vdLN9N1os+hn0WWlj9wT8URlvACSlpIm5O0I5MGaR2XFWl1zA5S404ZJzL19EknJs2kFc44tEaGKw40OEDa3KXlHs3eL3UnlBO5auK7D7qiVimRF18vK5TlisHi4iIvcsmTXlXas1r9gF+nzZ6DI5A2F2llj7SilDyVTZwdIPVdruOoIPT/yGsFg2o9gc6k+j3x5Mn3g4JoEj3Q1WN5qX4HikBaG6RlRal49gMpIt/1yia+PKfVeEeVJ6xOIIZPKUWtIu21FUJeWp3gklIBAZA2B2lF+erqwfn5BmOc9o5OPaLhLb1wZxWVu43xBVNp5asvUS6HWakOIG3OdVpehf3TvJjeuKBIGzYIx+sKpNjtdhjCAabS8okTvdoHAEDanKSV6wf6QK21tIqd6qtu9ZLMWlphTK4fsMeJARgCaXON04afpgdqraV9OWgq7cmVpeXPLghzCNJCWruaccNtRz7oA7WrLmkzSMtDtbOlfQjSQlo7O8yUtTVNKg2wZtLyeBiPKAhiWp02k7Q81aJuCQDS5hDy8p4mMJPk8OuoqbRy9OCkPr4wKmQprRzjRZAW0tohreFOLkVQU2lntAZdRcKTFtLySoS+a+K3ad0YAKTNoaTl/r2kl/Ti0xWqB0qUgTaTTSXUQJeptI4f7lX1GqRVOzggSAtpc5e2YY7b9P3NFt5Ja6LXXFqtxVbfY9FcWkOHGcN0BGkhrQ0XYl19xs5bo4KFtLpzvOZfmrRaTzCjtHKo1uFAkBbS2hE9GDFYOypaSmvseftKMJN2ZNJc2v4+B4K0kNa+kFf4hhqlfXBZINKendS6GRiaXruUsJjjB/mGG31SnsQ3aSYt7+qlNZ0BSJtjnFbc37698v690szfhCR+sufA/Xta35rlCQTxhN+/3296vTeBIC2kta9xQcxy32g6URRXdTy67pUe/RxBWki7kb418RaCtJB2o0n7reGuMgBpN5K0iHdB2g1WPXgAZyHthpF2avveoaH78xAD0m6sr68XoQWkxZgLANICSAtpAaSFtADS6giXV2xG3B/SbqRbyG/UU4YignjrtJW7ZZsEYaQ+7QuNlk0w0vX5eSXdgNB/iq2l/vQzQZipN/2CWuvF0bXnELkguyV2RFazHHYkaGrjITnLN3yknk+89Ife9D0YgLT/Y+/8XttKrjj+P+UmKSLbQrvNbkDN5scudmIZxk47KmkoS9I6qyARZZ0IWT+QLMUCC4yNIhDryDFmjVfYxhFkCazUB0P6svuwUNJCn/K6L3npOfPj/pDln3J+le8JxNLcM2fuzHzumTPnSldv5WEdWTnVGrqVlmUCa243X5yladrB2orc8+nIOQvhFs0lTfTp06evdGS96FRLfT/ttbWbOdX60YW7pc7l4Ha4itIODInQPRJLsh5XF2WvuRVZALRvA9qcLGswSoXErq4uxU6zWu/5gtfY9ehe41CxEFZLRQWuJnN2N3aq9fgerQ/gab/qklMsHsYOV1HawSHR0M7Le+qqq+zwq0v1OKB9G9AmzbRUSoWkbHVkqUnTK9o3pRze5tgh375548thKh7L1uaH9ZMUm3EdVyw7G+NS3lx26Vq8R4pdu8QayBWk1rvSvCeC7OSMiVi2tpaRN5b5sQqLf5b3NqmRXPP84ugNbj3uJCiM4aPUrNFzNkyRUlMPbtziU0stNulqSnWWdXmuuTacpiYWg3ZyzQ3T234VT2htb0h0wJNX/WpzZ1LkaMXaDSm5w6qlaeWW18Y/GSa5+JuLRfdwkq2L1KVJR6yNytJm6mIB0A7kaae6rmuUU7/uyFo0tiSnfrsgyVMmMlLea9I0jw9fzTSsp9FLZkJSQenKQsZ6VIpbhz9dNAEfvatF3djW9a5VOZnr8V7GBDc1Ta/yVCSnv0hzK1WKgkfHufUiFz7OUNWgnipSannt1Avszdnjrci8Lq/W2xmysrkYtFO1vXX6VKyf0NqVgFIiM8vdb6jYltRiM3Lq40UV8XBLrUzDoaGrbYyPj/8qI+td77C6fpO6xqe8iZgEtANASxGavNnq6ui2rLceFRUycOCQlHLbEaJKyOVkXvlIMVMqGh+dV1M9L8s2pGMaqwZP16HmFGm1cCTyFbnGOS9s8GhhE0SvekWeuE4vYjOlAp3RXFxb1IWp9BQ5v4AeFY1oNeUw6RhdO/x/pqarkwePqj2eCNgZcXvbryJRytqxoBJ3iRcQhpdPpSIbjqZXtUQsp7JSP6o3kS5N+g7X9GJW1CO7JetFQDtQyotWSbWrJ7CiaoZ4PsyyXlEcqu1IhSGqMYPmCcpqDhpRJ/XYfBgm0YoybGaGkzbkY0hz0shmVMwEZsw1oUNEwmtFV0wylmxLt65Jr9SLrp5bdNXbEbEP3JK/I/YqfI1xOZOm9nhBO1dtb+P9KppdaSKoFEuX2dEqj0tnSXjrkLuhW6rUb2dKeYN3adJ/mIdMzNiR1WYB7QDQCkds8K4+ZwE163eMRnjGDHKDhzzOs+cu9FxAjqW0WbQfh4m2F8dHpQkeRMVEsSq2XZHLQySLNOMUNvgbNyaUOfZLpYJpgKDVJ8Ktkyu7SYvueKZU8PRsUduLN+bJraVr/5YFJkZXpxVCL89BO23vcuxTMa+0nVxQKZYtO9wbgtb4fLZ1Q5aVnpihi7Ls+lnHfzivzJRNVi8hyw6gPTK0qU7eXaVXFGU0rjmNG80VjbN1msbbFm0awFHHRJuWVFMwT9uj33+yYAhy4ebY1m7K2Mi89dQWW23CNLX0fTxbtgu2PiNuPZatX7x06dLFP0z79GxRxUuh0VYpyZ4yz+k4XX3FrBA9diq2t7tUVAvFSlAplp1TZ0/wJlVM/SXZunT27LbSo+iimVWhE72adHyH3bbMrvc9zOd+UNBaJ0LDrhdBWkkNtBQHmOmiRVnPXE6ec/0k091iNbM407Jf8GVbXWhz2ruq9VAQPVv+GRMb1oRuKpaei2VNDq5e1GfErdvCW90dere6vhsAqfQ0xaOJzCb1S6/q/L8Or4N23N7uUpG1RY8Sve/U1S+lNLl3OR3cb1zTejowLytmOcvgHdaLg7sHFUulAqAd4AF0M/quTipdP6H5rXKc0NBFRT1dYqZmZo527u5dICrQm2Kz89LuLJU1uUqaGW05SzNkN2X8N5judU3opmhRZlrV/qWsryjVuimkeLNXryKXfTcAaPlXS7vaUalyfWsh32tn2e1t/4pKO9WjxPmVhlGetdE9xbNab0sWON1dTKV1z93DdP1G+S3v4GisREVOxQHtADEtZ4CG/rqQkY2EmY9alDzF5kRbpYXUdNGgX+iql6m0G42JKjM9de78gqwZ/uXmCVrq69ue5WtDjzNcw27KCFqa8Ok/kVxW2V3hmnCzQjT5Ux9RETlIc0bUui5clLVojx4VJXzxBp0E+XS96dfl/H+SziQatOP1tn9Fpb1DqaK3/WJJ6h2iHqe81lM3R8jVZmXtwqlTX2y7h3lkzq9JbqBCcW7Ghv2A9sh52gxv6kvL5sa6ChkT/EGBUt44T54rmoqaWpVdp8PH+ADNhZt6pzdNy7C1XF/Wdy5sNKK0VDXLgTJhmlqhJVUXNePmjIRyb7awj17On0JTuQXtT3V5TqeA68WgHV9v+1ZU2n2UGp6yHSczdPrMYjN108Gye5ijfbqClZn28F+a7UwD0A6YPRg7fz1s0giuw5qIRPwqd0Z6Pk7gLscTE3fcSiI8NuY4I97RkQljeS/xm7BnNDEx4jsj3Xrs5ETvc2tUkej7ZR7hVRd0ZiPRoB2x6zeA3IpKe9evCZkDkYmJnqELaLiHI9dVErHTCNzfBrRv/vO0IpF+l8GYeM/sHF5ooeJ7uvK9y9L+/0Lr34VBjiRbUt5Tez1A+5agjd2+0AV3g8nGlbNnW+/jR8HwdRvInuGJALSAFgJoIYAW0EIALaCFAFoIBNBCAC2ghQBaCATQQgAtoIUAWkALAbQQQAtoIYAW0EIALQTQAloIoAW0EEALAbSAFgJoAS0E0EIALaCFAFpACwG0EMiHDO2d8JjAxAHaDwfaxPjrEMm/dv7yXar0w37PWY+dfdVbT6y9csvIwpO4M1/6wcjUsro4Fl/N4SIBtEeHdi1k5dveh0wlHoTu7tPZxDqr5F5973uo2o8htxpZeBh3tkKePONHuX7DpRBAe9SHKhNIT6dbV76jvz8fGlqhoU2GVif3gDYZCv3yioVdOr0HtIB2IGhnQqFH6kWFvGDx0J429vdW8SDQmoL2Or8EtIB2EGiJH8Ob+CZAngtt+LOPTnoBaGxo6Ix6xvXQC99zPw8MrbMEaAHtMUAbMrxVXv8y6fJF5Y8YubkMB6KrZVO0ts7vZhMcTISe8o9n/Sd090cdrT46CLRbgBbQDgqt+AdFBXm/z1R8CaJNQWvlZ813UIg8dsZLZh93EGizgBbQDhzTqp396pPN7QC0jgdtuTvRoT+zGtq57sY/OQeQH2k/4JiAoY39rUO+uLW9P7RiQQXOgBbQDpjyWteOcvXJdj9oZ80m7VsFLecX5tdDzzjBVbXQcgpi3+zBf0lUPvguUl6AduCbC7HHpXU3BuiF9qHag1Hk+lOBUFPpBXXI7r40tPtvxLxksANoAe1x3MYV5z8eZaKe74D2Z7vpX520qB0J2qd1viH2nWoD0ALawbIHZ84YfFJp3ln1QnvXcjggtKaggpsLgHZgaLc8wFIP+kD73G76DwFtcndoKc7ARgzQDvqDzl6qioDyoKXdVp+Y9mDQ0oXwULj8PvJTLNKsCWgB7SDQcoLgucda3BKZDfVkDx6KvaH1fWBmft1CSrD7d3cmzgC0gHawjViV9kYvr4UjQx2VPmBOy2Mb6VDIy9OGF0L+WwJ9oQ299PK0THzo5fad8GOq/1PB6bmNqzK+z6atFEEMoD0ktLG0l456ZICz73x3xB45+0DruyOmHKyV2WCQW+Erw39vbRU/twtoD5/yWruv8XmqIoGYonZ1Oa2hLXfczx6I7K7Qis564IONYuG1tvmy0LMzy3EMAmgB7cB52sjtVutc1/6m/MjVFyeF9wPzsesvTh7oawYBJXG11Wpd6zr4ggKgxRcbIYAWAgG0EEALaCGAFgIBtBBAC2ghgBbQQgAtBNACWgigBbQQQAsBtIAWAmgBLQTQQgAtoIUAWkALAbQQQAtoIYAW0EIALQQCaCGAFtBCAO1xQHv/6z9CDiFf3we07xza4VMXIIeQU8OA9p1D+3lkBHIIiXyuhm30uAXQHkIujyH2O4yMXdbQjkWPU8YALaB989BGwuEI/QvrP+Zl2P8+4i8IHnAP2pcRQAto3zy0nx2rDAFaQPu/9u43tKrzDuC4tUl1UWts1RljNFWX7XXMXlTzYrI3GYdsLzZs9U6821hQNtlZ59WIZaUdUgZmSt2CBHFbiRFZmTYw5qJdg2BwbjHDFwHBsNJUqmIhb9ybvdnz/zzn3JvknnNvYoTvN5A/5x4TuP3w4znPuUnnHu3uA9VsN2hBO/doDxypZgdAC9p5QlsQb+L94e99vSMCWDCHiyv9iDwG2m1vTpm/On85PNPdF6qu/fHYtu6+QdBWCW2n0FZQAj/+j3x+/zZw5Mhkz41CCa7ivMLBjkJpyOa7gPZcj0P7y+6+V38g+v6D8PQx0FYPraIom+wJv/jW3ofhyEBBoy04qa5c59TpGFrvIfUetAm0+vPu4ZEToK0i2lwhp+oNB3Li88v9d7dP9t/wpeakSPOub1B+HXvQ/HtZoQDaUmi3/cv7fNu+j6/uA21laE29l06oj0/utk32n/1nv1iICahD7z4I790cy+U++GTo3T/86EL/vQsDuaGHD8JrZwu5yc+u6vMitaAtibb3yjsR2u6+0WOgrQStnpNBENwO/ztm6ImVwsjNnz8IJ3JD58P//eRxODqW6x0Ren/90/DehwOTU+Hnr50PP/XO0wWgTaL9d6Gzs/Pww/D6MR/tXdBWhDZn73INiSvdazdP7VBoxdQNJnuuizXDWfHgB+Fg0BuO/1mc1jcYiE8ngqDwZOSMPC/IyfPsPTPuiCXQ6t2D8NJJdg+qj1aK+/3DfvH8fj4mGA6Kw4W++7vP320VjxT6xsfEkjfQaIemFNLJ/glxnjh0pO9+q73BC9oE2r8feuON73zjcfgpaOdi0oq3XG7o4vlwfExciMnDw6NKpaj3yone8THFd1BM4PDC/v37H4SD4jwJdXi01cEH7bme94vWtMf7Rk+CtopoDbehzwb0J8PhDYVRUB0dmtJob1860atkykl77vyVX8l+/J47D7RRbsX6yLsQu33pHdBWH+1kz2n1Mf8ohlYdzA2L5cFoq5m057Tk3D+ugrZUveEN+eHNqfGT06Bly6s6aPO5vpEBDTQcMBhvj94aVgc/6j8tZN4ykzZ4Ii6/guBROOHQ3gKta9+5qfDmX39xsSeciNax6pbuvZ+9JvsTW16Vo83LguByGH7x3W+KNe1dcY11Qx4SaN/qv3L28MX+K2fkF+LQ8b77p8Yuh+OnDv62f/w3Edq8/ib5ALRC7WO5YXDvvW0R2o/C97ufmJ2Eu3m2vCpHq96C4C/qtQfhJ7fy53puiEP53utB/q0H8vkfCDTafNAbhhP538ldhldPyPMU2uv6e4DWdnz3kbYiyyX+9+GgzYZWD1pd58FDHTnpN+8mZz7/7V0d+URBcPBQu37UnmgfAG2aQJsVbWB9en6jL+wItQdip5kHAscWtKCd50lbeaAF7Tyh3SPeiis+6h1JPLjHHAAtaOcBbb6qf02BXyEHLWhBS6XQHj26R7+Jjprk164u+1X8vK6uLnM0ehC0qXo9v49SlH+dSfvU0e49vItSdHivRsvf8uLv0xJoiUBLoAUtgZYItARa0BJoQUugJdCClkALWgItgRa0BFrQEmgJtKAl0IKWQEugBS2BFrQEWiLQEmhBS6AFLYGWQAtaAi1oCbQEWtASaEFLoCXQgpZAC1oCLYEWtATarGhbQUuzo21daGi332nv4r8Nla6r/c72hYe2TaBtQy2VNtsm0LYtQLQ77rR3dPyQqKiOjvY7OxYkWqlWsCVK1i7NLkS0Su2ddgGXyE+g0GYXGlqtdvsOohJtL8fs/KOVaoVbKZconrIxq9mngFarJZqm1oWIFrdUgdinhpaogkBLoOUpJdASgZZAC1oCLRFoCbSgJdASgZZAC1oCLRFoCbSgJdASgZZAC1oCLRFoiUBLoAUtgZYItARa0BJoiUBLoAUtgZYItARa0BJoiUBLoAUtgZYItESgJdCClkBLBFoCLWgJtESgJdCClkBLBFoCLWgJtESgJdCClkBLBFoCLWgJtESgJQItgRa0BFqiadsJWnrWzL5dOdrlAm09aGnezO7y0dYLtMszol25ahVoaX7MRmhXZkNbB1qaX7M7K0W7zJu0L60GLc29Wb2mXe2jXQZaWtBmd2VAu6QIbUt9g0W7DrQ012ZbX1ln0TY0tBShXTId2qWLa2oSaPX2AWhpjs3ulGjVkjaOtqZm8dJy0K5waO2eVzNPLs2t2bdbm6NtWoN2xaxoa+NoXwAtzaPZXT7a+pYX4mhry0Tr7i6sBi3NQ81mSavvLaRD+9wKuVFr0K5ZL6/EXmxufkX2Nd1XdV8hypghZEApXM3NL8bR1gm0z5WDdrFFq/a8oiuxtWs3bNi8ubGxqalp48YtW7Zs2rR169Zmoixtbd66ddMmwWjjRgGqqXHz5g0b1qpbC6vXq80De29hhd48KAOtvSXmLWqFWo3WUyvZApcymJVkPbMa7Tq7pF1jrsOiG2Kl0SbuLvjbB2qn1o3apkaJVrK1aolSp8xKR5FZMWjt6kBch7nNg+nvLRSjrTNXYvr2glgfuAWCU6vcEmVoy5aEWTNoo/theklbJtrFNUm0av/AW9XqFYJmC1zKAtaRFWYTgzaBVpgtH62/qPVHrVnXemyJ0mbJqjmrzdpB624tlIe21qK1N3LVLy+sWW9GbUKtYkuUraYis2rQml9bsDdxLdraadAWv85Lb3rZUSsXCE6tZgtcyg7WLA3UgtYbtGsaGsythcRrvGZFaxa1Zv9AjlqnVl+NRW6JMtXYaK/n9O/WAAADe0lEQVTBIrNudVDiOmwmtGZ9UOcuxfSojam1boFLmcHKKRszqwetvYdb560OykHrv/zArGqN2jjbpkaijBmyamlgzepB673wIC1at3+gFwieWss2GrhEKb06snGz7s5CXQq00aJWj1qldlWkNmLr4BKlTgGyZJ3ZVSvtilZehkU3cadHK18GXjRq9arWzVo1bBVb7ZYoa2sdWWd2jbqxUDxo1UvAi9EmR627FNMLBKvWstVusUvZwUqxgqwas8asWRy4y7CZB20JtNEGQqTWsk3AJUrZOitWk3VmG9zWQZlo3asTY6taT61jG8ElypQE5JGNzMZWtN7rEmdAG1NrFghmhWDZSrcOLlGmvqzBemSV2ZZo0Dqzs6N1l2JJtZqt59baJUrXapcSa8gmzPqXYdOhXeTQ+gsEp9Zja9x6dIlSJwFpsZZsZDY+aKdd0haPWl/ty0KtYmvdrpI/7iWijK3XabGObMxsGYPWQ+svELRan610q+E6vURp03q02IisM2sXB7OgTYzaYrWSbX1DBNenS5QuLUjP2Ib6+pZis2UMWou21o5aX61mG3fr4SVK30o9YhXZlw3ZpFm1dTAT2kUWbbFazVa7VXDr5Q9bSZSxBlO9EyvJljBr0C5aNNuojav12Rq3Rq7VS5Q+qafFio3IljQ7PVozakup1WydWyM3ppeo/CQdBcmJlWRLmp1x0OpRa3cQrFqfrXNr6RJlzkpaniRrzUZXYWWgdaPWU2vZSrcOLlFlLTdiDVnPbGxxMBPaadQattKthltnfhZPOlWE1YFVYjXZtGYTav1h67k1cOtifonSJvks88TGxmz5Zh3apFrPrYZbhJcoRQ7RCl9skdmy0MbUmiWCZavcGri+XaIMOUjPO7GGrF4alG9Wo/XUWrbGrYYbySWqoOc9sEKsJRs3OzvaolkbsbVurVyiSnOkajyyKedsNGuL2Wq4kVyiqlTjwJYgWyZaf4mQZGvgYpeqpTUCGydbm4qsm7Vu2Gq3EVwfL1HWYqCWWrGxMVs+2tgSwbDVbhNyiaqQofWliGxterKJYevcOrngpephjbwasVnGbJytcRvBjdklqiRfVW1cbHqyMbbWbVwuUbVywJZURjbO1oMLX6oy1STYCsgWuS1hl6jiksYWVaMlRPPUoqrG80nPklf40rNJlYiIiIiIiIiI6Jno/9ALOeIl4ZqbAAAAAElFTkSuQmCC)

## Step 0: A Basic WSGI Introduction

Werkzeug is a utility library for WSGI. WSGI itself is a protocol or
convention that ensures that your web application can speak with the webserver
and more importantly that web applications work nicely together.

A basic “Hello World” application in WSGI without the help of Werkzeug looks
like this:

    
    def application(environ, start_response):
        start_response('200 OK', [('Content-Type', 'text/plain')])
        return ['Hello World!']
    
A WSGI application is something you can call and pass an environ dict and a
`start_response` callable. The environ contains all incoming information, the
`start_response` function can be used to indicate the start of the response.
With Werkzeug you don’t have to deal directly with either as request and
response objects are provided to work with them.

The request data takes the environ object and allows you to access the data
from that environ in a nice manner. The response object is a WSGI application
in itself and provides a much nicer way to create responses.

Here is how you would write that application with response objects:

    
    from werkzeug.wrappers import Response
    
    def application(environ, start_response):
        response = Response('Hello World!', mimetype='text/plain')
        return response(environ, start_response)
    
And here an expanded version that looks at the query string in the URL (more
importantly at the `name` parameter in the URL to substitute “World” against
another word):

    
    from werkzeug.wrappers import Request, Response
    
    def application(environ, start_response):
        request = Request(environ)
        text = f"Hello {request.args.get('name', 'World')}!"
        response = Response(text, mimetype='text/plain')
        return response(environ, start_response)
    
And that’s all you need to know about WSGI.

## Step 1: Creating the Folders

Before we get started, let’s create the folders needed for this application:

    
    /shortly
        /static
        /templates
    
The shortly folder is not a python package, but just something where we drop
our files. Directly into this folder we will then put our main module in the
following steps. The files inside the static folder are available to users of
the application via HTTP. This is the place where CSS and JavaScript files go.
Inside the templates folder we will make Jinja2 look for templates. The
templates you create later in the tutorial will go in this directory.

## Step 2: The Base Structure

Now let’s get right into it and create a module for our application. Let’s
create a file called `shortly.py` in the `shortly` folder. At first we will
need a bunch of imports. I will pull in all the imports here, even if they are
not used right away, to keep it from being confusing:

    
    import os
    import redis
    from werkzeug.urls import url_parse
    from werkzeug.wrappers import Request, Response
    from werkzeug.routing import Map, Rule
    from werkzeug.exceptions import HTTPException, NotFound
    from werkzeug.middleware.shared_data import SharedDataMiddleware
    from werkzeug.utils import redirect
    from jinja2 import Environment, FileSystemLoader
    
Then we can create the basic structure for our application and a function to
create a new instance of it, optionally with a piece of WSGI middleware that
exports all the files on the `static` folder on the web:

    
    class Shortly(object):
    
        def __init__(self, config):
            self.redis = redis.Redis(config['redis_host'], config['redis_port'])
    
        def dispatch_request(self, request):
            return Response('Hello World!')
    
        def wsgi_app(self, environ, start_response):
            request = Request(environ)
            response = self.dispatch_request(request)
            return response(environ, start_response)
    
        def __call__(self, environ, start_response):
            return self.wsgi_app(environ, start_response)
    
    
    def create_app(redis_host='localhost', redis_port=6379, with_static=True):
        app = Shortly({
            'redis_host':       redis_host,
            'redis_port':       redis_port
        })
        if with_static:
            app.wsgi_app = SharedDataMiddleware(app.wsgi_app, {
                '/static':  os.path.join(os.path.dirname(__file__), 'static')
            })
        return app
    
Lastly we can add a piece of code that will start a local development server
with automatic code reloading and a debugger:

    
    if __name__ == '__main__':
        from werkzeug.serving import run_simple
        app = create_app()
        run_simple('127.0.0.1', 5000, app, use_debugger=True, use_reloader=True)
    
The basic idea here is that our `Shortly` class is an actual WSGI application.
The `__call__` method directly dispatches to `wsgi_app`. This is done so that
we can wrap `wsgi_app` to apply middlewares like we do in the `create_app`
function. The actual `wsgi_app` method then creates a `Request` object and
calls the `dispatch_request` method which then has to return a `Response`
object which is then evaluated as WSGI application again. As you can see:
turtles all the way down. Both the `Shortly` class we create, as well as any
request object in Werkzeug implements the WSGI interface. As a result of that
you could even return another WSGI application from the `dispatch_request`
method.

The `create_app` factory function can be used to create a new instance of our
application. Not only will it pass some parameters as configuration to the
application but also optionally add a WSGI middleware that exports static
files. This way we have access to the files from the static folder even when
we are not configuring our server to provide them which is very helpful for
development.

## Intermezzo: Running the Application

Now you should be able to execute the file with `python` and see a server on
your local machine:

    
    $ python shortly.py
     * Running on http://127.0.0.1:5000/
     * Restarting with reloader: stat() polling
    
It also tells you that the reloader is active. It will use various techniques
to figure out if any file changed on the disk and then automatically restart.

Just go to the URL and you should see “Hello World!”.

## Step 3: The Environment

Now that we have the basic application class, we can make the constructor do
something useful and provide a few helpers on there that can come in handy. We
will need to be able to render templates and connect to redis, so let’s extend
the class a bit:

    
    def __init__(self, config):
        self.redis = redis.Redis(config['redis_host'], config['redis_port'])
        template_path = os.path.join(os.path.dirname(__file__), 'templates')
        self.jinja_env = Environment(loader=FileSystemLoader(template_path),
                                     autoescape=True)
    
    def render_template(self, template_name, **context):
        t = self.jinja_env.get_template(template_name)
        return Response(t.render(context), mimetype='text/html')
    
## Step 4: The Routing

Next up is routing. Routing is the process of matching and parsing the URL to
something we can use. Werkzeug provides a flexible integrated routing system
which we can use for that. The way it works is that you create a `Map`
instance and add a bunch of `Rule` objects. Each rule has a pattern it will
try to match the URL against and an “endpoint”. The endpoint is typically a
string and can be used to uniquely identify the URL. We could also use this to
automatically reverse the URL, but that’s not what we will do in this
tutorial.

Just put this into the constructor:

    
    self.url_map = Map([
        Rule('/', endpoint='new_url'),
        Rule('/<short_id>', endpoint='follow_short_link'),
        Rule('/<short_id>+', endpoint='short_link_details')
    ])
    
Here we create a URL map with three rules. `/` for the root of the URL space
where we will just dispatch to a function that implements the logic to create
a new URL. And then one that follows the short link to the target URL and
another one with the same rule but a plus (`+`) at the end to show the link
details.

So how do we find our way from the endpoint to a function? That’s up to you.
The way we will do it in this tutorial is by calling the method `on_` \+
endpoint on the class itself. Here is how this works:

    
    def dispatch_request(self, request):
        adapter = self.url_map.bind_to_environ(request.environ)
        try:
            endpoint, values = adapter.match()
            return getattr(self, f'on_{endpoint}')(request, **values)
        except HTTPException as e:
            return e
    
We bind the URL map to the current environment and get back a `URLAdapter`.
The adapter can be used to match the request but also to reverse URLs. The
match method will return the endpoint and a dictionary of values in the URL.
For instance the rule for `follow_short_link` has a variable part called
`short_id`. When we go to `http://localhost:5000/foo` we will get the
following values back:

    
    endpoint = 'follow_short_link'
    values = {'short_id': 'foo'}
    
If it does not match anything, it will raise a `NotFound` exception, which is
an `HTTPException`. All HTTP exceptions are also WSGI applications by
themselves which render a default error page. So we just catch all of them
down and return the error itself.

If all works well, we call the function `on_` \+ endpoint and pass it the
request as argument as well as all the URL arguments as keyword arguments and
return the response object that method returns.

## Step 5: The First View

Let’s start with the first view: the one for new URLs:

    
    def on_new_url(self, request):
        error = None
        url = ''
        if request.method == 'POST':
            url = request.form['url']
            if not is_valid_url(url):
                error = 'Please enter a valid URL'
            else:
                short_id = self.insert_url(url)
                return redirect(f"/{short_id}+"
    
    
                )
        return self.render_template('new_url.html', error=error, url=url)
    
This logic should be easy to understand. Basically we are checking that the
request method is POST, in which case we validate the URL and add a new entry
to the database, then redirect to the detail page. This means we need to write
a function and a helper method. For URL validation this is good enough:

    
    def is_valid_url(url):
        parts = url_parse(url)
        return parts.scheme in ('http', 'https')
    
For inserting the URL, all we need is this little method on our class:

    
    def insert_url(self, url):
        short_id = self.redis.get(f'reverse-url:{url}')
        if short_id is not None:
            return short_id
        url_num = self.redis.incr('last-url-id')
        short_id = base36_encode(url_num)
        self.redis.set(f'url-target:{short_id}', url)
        self.redis.set(f'reverse-url:{url}', short_id)
        return short_id
    
`reverse-url:` \+ the URL will store the short id. If the URL was already
submitted this won’t be None and we can just return that value which will be
the short ID. Otherwise we increment the `last-url-id` key and convert it to
base36. Then we store the link and the reverse entry in redis. And here the
function to convert to base 36:

    
    def base36_encode(number):
        assert number >= 0, 'positive integer required'
        if number == 0:
            return '0'
        base36 = []
        while number != 0:
            number, i = divmod(number, 36)
            base36.append('0123456789abcdefghijklmnopqrstuvwxyz'[i])
        return ''.join(reversed(base36))
    
So what is missing for this view to work is the template. We will create this
later, let’s first also write the other views and then do the templates in one
go.

## Step 6: Redirect View

The redirect view is easy. All it has to do is to look for the link in redis
and redirect to it. Additionally we will also increment a counter so that we
know how often a link was clicked:

    
    def on_follow_short_link(self, request, short_id):
        link_target = self.redis.get(f'url-target:{short_id')
        if link_target is None:
            raise NotFound()
        self.redis.incr(f'click-count:{short_id}')
        return redirect(link_target)
    
In this case we will raise a `NotFound` exception by hand if the URL does not
exist, which will bubble up to the `dispatch_request` function and be
converted into a default 404 response.

## Step 7: Detail View

The link detail view is very similar, we just render a template again. In
addition to looking up the target, we also ask redis for the number of times
the link was clicked and let it default to zero if such a key does not yet
exist:

    
    def on_short_link_details(self, request, short_id):
        link_target = self.redis.get(f'url-target:{short_id}')
        if link_target is None:
            raise NotFound()
        click_count = int(self.redis.get(f'click-count:{short_id}') or 0)
        return self.render_template('short_link_details.html',
            link_target=link_target,
            short_id=short_id,
            click_count=click_count
        )
    
Please be aware that redis always works with strings, so you have to convert
the click count to `int` by hand.

## Step 8: Templates

And here are all the templates. Just drop them into the `templates` folder.
Jinja2 supports template inheritance, so the first thing we will do is create
a layout template with blocks that act as placeholders. We also set up Jinja2
so that it automatically escapes strings with HTML rules, so we don’t have to
spend time on that ourselves. This prevents XSS attacks and rendering errors.

layout.html:

    
    <!doctype html>
    <title>{% block title %}{% endblock %} | shortly</title>
    <link rel=stylesheet href=/static/style.css type=text/css>
    <div class=box>
      <h1><a href=/>shortly</a></h1>
      <p class=tagline>Shortly is a URL shortener written with Werkzeug
      {% block body %}{% endblock %}
    </div>
    
new_url.html:

    
    {% extends "layout.html" %}
    {% block title %}Create New Short URL{% endblock %}
    {% block body %}
      <h2>Submit URL</h2>
      <form action="" method=post>
        {% if error %}
          <p class=error><strong>Error:</strong> {{ error }}
        {% endif %}
        <p>URL:
          <input type=text name=url value="{{ url }}" class=urlinput>
          <input type=submit value="Shorten">
      </form>
    {% endblock %}
    
short_link_details.html:

    
    {% extends "layout.html" %}
    {% block title %}Details about /{{ short_id }}{% endblock %}
    {% block body %}
      <h2><a href="/{{ short_id }}">/{{ short_id }}</a></h2>
      <dl>
        <dt>Full link
        <dd class=link><div>{{ link_target }}</div>
        <dt>Click count:
        <dd>{{ click_count }}
      </dl>
    {% endblock %}
    
## Step 9: The Style

For this to look better than ugly black and white, here a simple stylesheet
that goes along:

static/style.css:

    
    body        { background: #E8EFF0; margin: 0; padding: 0; }
    body, input { font-family: 'Helvetica Neue', Arial,
                  sans-serif; font-weight: 300; font-size: 18px; }
    .box        { width: 500px; margin: 60px auto; padding: 20px;
                  background: white; box-shadow: 0 1px 4px #BED1D4;
                  border-radius: 2px; }
    a           { color: #11557C; }
    h1, h2      { margin: 0; color: #11557C; }
    h1 a        { text-decoration: none; }
    h2          { font-weight: normal; font-size: 24px; }
    .tagline    { color: #888; font-style: italic; margin: 0 0 20px 0; }
    .link div   { overflow: auto; font-size: 0.8em; white-space: pre;
                  padding: 4px 10px; margin: 5px 0; background: #E5EAF1; }
    dt          { font-weight: normal; }
    .error      { background: #E8EFF0; padding: 3px 8px; color: #11557C;
                  font-size: 0.9em; border-radius: 2px; }
    .urlinput   { width: 300px; }
    
## Bonus: Refinements

Look at the implementation in the example dictionary in the Werkzeug
repository to see a version of this tutorial with some small refinements such
as a custom 404 page.

  * shortly in the example folder

© 2007–2021 Pallets  
Licensed under the BSD 3-clause License.  
https://werkzeug.palletsprojects.com/en/2.0.x/tutorial/

